window.__require=function t(e,o,n){function i(a,l){if(!o[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var r="function"==typeof __require&&__require;if(!l&&r)return r(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var d=o[a]={exports:{}};e[a][0].call(d.exports,function(t){return i(e[a][1][t]||t)},d,d.exports,t,e,o,n)}return o[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({AComponent:[function(t,e,o){"use strict";cc._RF.push(e,"200edlJDg1Bd7n8L01WpeuI","AComponent"),Object.defineProperty(o,"__esModule",{value:!0});o.default=class extends cc.Component{getLabel(t,e=null){return this.getNameComponent(t,e,cc.Label)}getButton(t,e=null){return this.getNameComponent(t,e,cc.Button)}getSprite(t,e=null){return this.getNameComponent(t,e,cc.Sprite)}getNameComponent(t,e,o){let n=this.getNode(t,e);return n?n.getComponent(o):(console.log("node no exist,name:",t),null)}getNode(t,e){return cc.find(t,e||this.node)}},cc._RF.pop()},{}],AdaptLabelWidth:[function(t,e,o){"use strict";cc._RF.push(e,"867d1KSBK9AZozGODmWeadi","AdaptLabelWidth");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:s}=cc._decorator;let a=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.maxWidth=0}onEnable(){const t=this.node.getComponent(cc.Label);t&&this.maxWidth>0&&(t.overflow=cc.Label.Overflow.NONE,t.horizontalAlign=cc.Label.HorizontalAlign.CENTER,this.node.width=this.node.height=0,this.node.once("size-changed",this._adaptSize,this))}onDisable(){this.node.off("size-changed",this._adaptSize,this),this.node.getComponent(cc.Label).string=""}_adaptSize(){const t=this.node.getComponent(cc.Label);t&&this.node.width>this.maxWidth&&this.scheduleOnce(()=>{t.overflow=cc.Label.Overflow.RESIZE_HEIGHT,t.horizontalAlign=cc.Label.HorizontalAlign.LEFT,this.node.width=this.maxWidth},0)}};return n([s],t.prototype,"maxWidth",void 0),t=n([i],t)})();o.default=a,cc._RF.pop()},{}],AdsController:[function(t,e,o){"use strict";cc._RF.push(e,"d2977QMqzRK6IUFDh9NSaCm","AdsController");var n=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});let i=(()=>{class t{static getInstance(){return this.ins}showVideo(){return n(this,void 0,void 0,function*(){return Promise.resolve(!0)})}}return t.ins=new t,t})();o.default=i,cc._RF.pop()},{}],AlertBox:[function(t,e,o){"use strict";cc._RF.push(e,"775c4JwDPpHWLi4H3JV0xGV","AlertBox");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:s}=cc._decorator;let a=(()=>{var t;let e=t=class extends cc.Component{constructor(){super(...arguments),this.lbTips=null}onLoad(){t.ins=this,this.node.active=!1,this.pto=this.node.getPosition()}static show(t){t&&this.ins.showTips(t)}showTips(t){this.node.active=!0,this.lbTips.string=t;let e=this.node;e.stopAllActions();e.scale=.8,e.opacity=255,e.setPosition(this.pto);let o=[];o.push(cc.scaleTo(.3,1).easing(cc.easeElasticOut(.4))),o.push(cc.delayTime(1.5)),o.push(cc.spawn(cc.moveBy(.3,0,20),cc.fadeOut(.3))),o.push(cc.callFunc(()=>this.node.active=!1)),e.runAction(cc.sequence(o))}};return n([s(cc.Label)],e.prototype,"lbTips",void 0),e=t=n([i],e)})();o.default=a,cc._RF.pop()},{}],ArrayUtils:[function(t,e,o){"use strict";cc._RF.push(e,"e12acXb0+1DPYxmhCEAWees","ArrayUtils"),Object.defineProperty(o,"__esModule",{value:!0});o.default=class{static remove(t,e){let o=t.indexOf(e);o>-1&&t.splice(o,1)}},cc._RF.pop()},{}],AssetsManager:[function(t,e,o){"use strict";cc._RF.push(e,"4ff65SjQF1EC4BiMehhvf5Z","AssetsManager");var n=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});class i{static getInstance(){return this.ins||(this.ins=new i),this.ins}loadBundle(t){return n(this,void 0,void 0,function*(){cc.assetManager.loadBundle(t,(t,e)=>{if(t)return cc.log("Error url ["+t+"]"),Promise.resolve(null);console.log(e)});let e=cc.assetManager.getBundle(t);return e?Promise.resolve(e):new Promise((e,o)=>{cc.assetManager.loadBundle(t,(t,o)=>{t?cc.log("Error url ["+t+"]"):e(o)})})})}loadAsset(t,e){return n(this,void 0,void 0,function*(){return new Promise((o,n)=>{cc.resources.load(t,e,function(t,e){t?n(t):o(e)})})})}getTowerSkeletonAssets(t){return n(this,void 0,void 0,function*(){t>28&&(t=28);let e=`spine/tower/plant${t}`;return yield this.loadAsset(e,sp.SkeletonData)})}getSeedTowerSkeletonAssets(){return n(this,void 0,void 0,function*(){return yield this.loadAsset("spine/tower/flowerpot",sp.SkeletonData)})}getEnemySkeletonAssets(t){return n(this,void 0,void 0,function*(){t>18&&(t=t%18+1);let e=`spine/enemy/monster${t}`;return yield this.loadAsset(e,sp.SkeletonData)})}getStageConfig(){return n(this,void 0,void 0,function*(){return i.getInstance().loadAsset("config/stages",cc.JsonAsset)})}getTowerConfig(){return n(this,void 0,void 0,function*(){return i.getInstance().loadAsset("config/towers",cc.JsonAsset)})}getEnemyConfig(){return n(this,void 0,void 0,function*(){return i.getInstance().loadAsset("config/enemies",cc.JsonAsset)})}getBulletSpriteFrame(t){return n(this,void 0,void 0,function*(){return i.getInstance().loadAsset(`bullet/bullet_${t}`,cc.SpriteFrame)})}getDialog(t){return n(this,void 0,void 0,function*(){return i.getInstance().loadAsset(`dialog/prefab/${t}`,cc.Prefab)})}getEffectPrefab(t){return n(this,void 0,void 0,function*(){return i.getInstance().loadAsset(`effect/prefab/${t}`,cc.Prefab)})}getSound(t){return n(this,void 0,void 0,function*(){return i.getInstance().loadAsset(`sound/${t}`,cc.AudioClip)})}}o.default=i,cc._RF.pop()},{}],Attackable:[function(t,e,o){"use strict";cc._RF.push(e,"a10daJYgTRJeKU0HKn5wpmL","Attackable");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../BattleController"),a=t("../BattleEvent"),l=t("./Tower"),c=t("../../common/AssetsManager"),{ccclass:r,property:d}=cc._decorator;let u=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.display=null,this.cdTime=0,this.target=null,this.ptMuzzle=cc.v2(),this.isFiring=!1,this.orientation=0}onLoad(){cc.systemEvent.on(a.default.enemyRemoved,this.onEnemyRemove,this),cc.systemEvent.on(a.default.speedUp,this.onSpeedUp,this)}onSpeedUp(t){this.display.timeScale=t?2:1,this.cdTime/=this.display.timeScale,this.showSpeedUpEffect(t)}init(t){this.display=t}updateTowerConfig(t){this.config=t,this.updateMuzzlePoint(),this.cdTime=.01,this.display.paused=!1}onEnemyRemove(t){this.target===t&&(this.target=null)}tryFire(t){this.isFiring||(this.cdTime>0?this.cdTime-=t:(this.target&&this.isUnderFireRange(this.target)||this.getTarget(),this.target&&this.fire()))}getTarget(){let t=s.default.getInstance().getAllEnemies();this.target=t.find(t=>this.isUnderFireRange(t))}isUnderFireRange(t){let e,o=t.getAttackedPoint();try{e=this.ptMuzzle.sub(t.node.parent.convertToWorldSpaceAR(o))}catch(t){console.log(t)}return e.mag()<this.config.distance}updateOrientations(){if(!this.target||this.isFiring)return;let t=this.display,e=this.node.parent.x<this.target.getAttackedPoint().x?1:-1;this.orientation!=e&&(this.orientation=e,t.node.scaleX=Math.abs(t.node.scaleX)*e,this.updateMuzzlePoint())}updateMuzzlePoint(){let t=this.display,e=t.findBone("boom");if(e)this.ptMuzzle=t.node.convertToWorldSpaceAR(cc.v2(e.x,e.y));else{let e=t.node.scaleX;this.ptMuzzle=this.node.convertToWorldSpaceAR(cc.v2(-10*e,80*e))}}onEnable(){this.onSpeedUp(s.default.getInstance().isSpeedUp)}onDisable(){this.display.paused=!0}fire(){this.updateOrientations(),this.isFiring=!0;let t=this.display;t.scheduleOnce(()=>{this.target||this.getTarget(),this.target?cc.systemEvent.emit(a.default.fire,this):this.cdTime=0,this.isFiring=!1},.3/this.display.timeScale),this.display.setAnimation(0,l.TowerActionType.attack,!1),t.setCompleteListener(()=>{this.display.setAnimation(0,l.TowerActionType.idle,!0)}),this.cdTime=this.config.cd/this.display.timeScale}update(t){this.tryFire(t)}showSpeedUpEffect(t){return i(this,void 0,void 0,function*(){if(t){if(!this.speedUpEffect){let t=yield c.default.getInstance().loadAsset("effect/anger/anger",cc.Prefab),e=cc.instantiate(t),o=cc.v2(),n=this.display.findBone("madness");n&&(o.x=this.display.node.x+n.x*this.display.node.scaleX,o.y=this.display.node.y+n.y*this.display.node.scaleY),e.setPosition(o),this.node.addChild(e),e.getComponent(cc.Animation).play().wrapMode=cc.WrapMode.Loop,this.speedUpEffect=e}this.speedUpEffect.active=!0}else this.speedUpEffect&&(this.speedUpEffect.active=!1)})}};return n([d(sp.Skeleton)],t.prototype,"display",void 0),t=n([r],t)})();o.default=u,cc._RF.pop()},{"../../common/AssetsManager":"AssetsManager","../BattleController":"BattleController","../BattleEvent":"BattleEvent","./Tower":"Tower"}],BalloonController:[function(t,e,o){"use strict";cc._RF.push(e,"f6f1aA5JNVHBr4Gi1GozCBL","BalloonController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("./UI/dialog/DialogManager"),s=t("../common/GameUtils"),a=t("./BattleEvent"),l=t("../common/data/UserDataManager"),{ccclass:c,property:r}=cc._decorator;let d=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.balloon=null}onLoad(){this.balloon.on("click",this.onClick,this),this.balloon.active=!1,cc.systemEvent.on(a.default.stageStart,this.startBalloonSchedule,this)}onClick(){i.default.getInstance().showDialog(i.DialogType.balloon),this.hideBalloon()}startBalloonSchedule(){let t=s.default.randomInt(30,60);this.scheduleOnce(this.checkBalloon.bind(this),t)}checkBalloon(){l.default.getInstance().hasBalloonRewardCount()&&this.showBalloon()}showBalloon(){if(this.balloon.active)return;this.balloon.active=!0,this.balloon.stopAllActions();let t=.5*-cc.visibleRect.width-200,e=.5*cc.visibleRect.width+200,o=.3*cc.visibleRect.height;this.balloon.x=t,this.balloon.y=o;let n=[];n.push(cc.moveTo(12,e,o)),n.push(cc.moveTo(12,t,o)),this.balloon.runAction(cc.repeatForever(cc.sequence(n)))}hideBalloon(){this.balloon.stopAllActions(),this.balloon.active=!1}};return n([r(cc.Node)],t.prototype,"balloon",void 0),t=n([c],t)})();o.default=d,cc._RF.pop()},{"../common/GameUtils":"GameUtils","../common/data/UserDataManager":"UserDataManager","./BattleEvent":"BattleEvent","./UI/dialog/DialogManager":"DialogManager"}],BaseController:[function(t,e,o){"use strict";cc._RF.push(e,"8f471aaZ7VJBIjbeyv+BTgT","BaseController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("./TowerBase"),s=t("./TowerFactory"),a=t("./DragController"),l=t("../BattleEvent"),c=t("../Configs"),r=t("../../common/data/UserDataManager"),d=t("../../common/GameUtils"),u=t("../../common/i18n/i18n"),h=t("../../common/data/GameNumberUtils"),p=t("../UI/dialog/DialogManager"),{ccclass:f,property:g}=cc._decorator;let m=(()=>{var t;let e=t=class extends cc.Component{constructor(){super(...arguments),this.towerBasePrefab=null,this.towerPrefab=null,this.dragController=null,this.towerBases=[]}onLoad(){t.ins=this,this.init()}start(){this.dragController.init(this.towerBases,this.towerPrefab)}init(){this.initTowerBases(),this.initEventListen()}startAutoGenerateSeed(){this.schedule(this.tryAddSeedTower,10)}stopAutoGenerateSeed(){this.unschedule(this.tryAddSeedTower)}initTowerBases(){s.default.getInstance().init(this.towerPrefab),this.node.children.concat().forEach((t,e)=>{let o=cc.instantiate(this.towerBasePrefab);o.setPosition(t.getPosition()),this.node.addChild(o),t.removeFromParent(!0);let n=o.getComponent(i.default);n.index=e,this.towerBases.push(n)}),this.node.children.reverse()}initEventListen(){cc.systemEvent.on(l.default.tryAddSeedTower,this.tryAddSeedTower,this),cc.systemEvent.on(l.default.towerGrow,this.onTowerGrow,this),cc.systemEvent.on(l.default.tryBuyTower,this.onTryBuyTower,this),cc.systemEvent.on(l.default.userDataLoaded,this.onDataInit,this)}onDataInit(){let t=r.default.getInstance().unlockTowerBaseIndexes;for(let e=0;e<this.towerBases.length;e++){let o=c.default.unlockCost[e],n=this.towerBases[e];n.showLock(!t.includes(e),o);let i=r.default.getInstance().towers[e];i>=0&&n.setTower(i)}}addTower(t){let e=this.getUsableBase();return e?(e.setTower(t),!0):(d.default.alert(u.i18n.get("lackedBase")),!1)}onTryBuyTower({level:t,type:e}){if(e===r.TokenType.coin){let e=h.default.getInstance().getCoinsPrice(t);if(r.default.getInstance().coins<e)return void p.default.getInstance().showDialog(p.DialogType.lackedToken,{type:r.TokenType.coin,expectedAmount:e});if(this.addTower(t))return r.default.getInstance().addCoinsBuyTimes(t),r.default.getInstance().addCoins(-e),d.default.alert(u.i18n.get("buySuccess"))}else{let e=h.default.getInstance().getDiamondsPrice(t);if(r.default.getInstance().diamonds<e)return void p.default.getInstance().showDialog(p.DialogType.lackedToken,{type:r.TokenType.diamond,expectedAmount:e});if(this.addTower(t))return r.default.getInstance().addDiamondsBuyTimes(t),r.default.getInstance().addDiamonds(-e),d.default.alert(u.i18n.get("buySuccess"))}}tryAddSeedTower(){let t=this.getUsableBase();t&&t.addSeedTower()}onTowerGrow(t){this.towerBases[t].growTower()}getUsableBase(){return this.towerBases.find(t=>t.usable)}static getInstance(){return this.ins}};return n([g(cc.Prefab)],e.prototype,"towerBasePrefab",void 0),n([g(cc.Prefab)],e.prototype,"towerPrefab",void 0),n([g(a.default)],e.prototype,"dragController",void 0),e=t=n([f],e)})();o.default=m,cc._RF.pop()},{"../../common/GameUtils":"GameUtils","../../common/data/GameNumberUtils":"GameNumberUtils","../../common/data/UserDataManager":"UserDataManager","../../common/i18n/i18n":"i18n","../BattleEvent":"BattleEvent","../Configs":"Configs","../UI/dialog/DialogManager":"DialogManager","./DragController":"DragController","./TowerBase":"TowerBase","./TowerFactory":"TowerFactory"}],BattleController:[function(t,e,o){"use strict";cc._RF.push(e,"5903bEn13RP2Juqop1cTjH7","BattleController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./Configs"),a=t("./enemy/EnemyController"),l=t("./bullet/BulletController"),c=t("./BattleEvent"),r=t("./tower/BaseController"),d=t("./effect/EffectController"),u=t("../common/data/UserDataManager"),h=t("../common/SoundsController"),p=t("./UI/dialog/DialogManager"),f=t("../common/platform/PlatformUtils"),{ccclass:g,property:m}=cc._decorator;let y=(()=>{var t;let e=t=class extends cc.Component{constructor(){super(...arguments),this.isSpeedUp=!1,this.enemyController=null,this.bulletController=null,this.baseController=null,this.effectController=null,this.isPassed=!0}static getInstance(){return this.ins}onLoad(){t.ins=this,this.init()}init(){return i(this,void 0,void 0,function*(){this.initEventListen()})}initEventListen(){cc.systemEvent.on(c.default.gameReady,this.onGameReady,this),cc.systemEvent.on(c.default.speedUp,this.onSpeedUp,this),cc.systemEvent.on(c.default.enemyEscaped,this.onEnemyEscaped,this),cc.systemEvent.on(c.default.enemyAllRemoved,this.checkStageEnd,this)}onSpeedUp(t){this.isSpeedUp=t,this.effectController.showSpeedUp(t)}onEnemyEscaped(){this.isPassed=!1,f.default.getInstance().vibrate()}checkStageEnd(){return i(this,void 0,void 0,function*(){this.getAllEnemies().length>0||(this.isPassed?this.handlePassStage():this.handlePassFailedStage())})}handlePassStage(){return i(this,void 0,void 0,function*(){h.default.getInstance().playSound(h.SoundId.victory1),yield this.effectController.playSingleEffect(d.SingleEffect.victory),u.default.getInstance().enterNextStage(),this.currentStageConfig.isBoss?yield this.showPassDialog():u.default.getInstance().addCoins(this.currentStageConfig.winCoins),this.startStage()})}showPassDialog(){return i(this,void 0,void 0,function*(){return new Promise(t=>{p.default.getInstance().showDialog(p.DialogType.passMainStage,this.currentStageConfig.winCoins,t)})})}handlePassFailedStage(){return i(this,void 0,void 0,function*(){h.default.getInstance().playSound(h.SoundId.failed),u.default.getInstance().addCoins(this.currentStageConfig.lostCoins),yield this.effectController.playSingleEffect(d.SingleEffect.failed,5),this.restartMainStage()})}getAllEnemies(){return this.enemyController.getAll()}restartMainStage(){u.default.getInstance().restartMainState(),this.startStage()}startStage(){return i(this,void 0,void 0,function*(){let t=s.default.stageConfigs[u.default.getInstance().mainStage][u.default.getInstance().subStage-1];this.currentStageConfig=t,this.isPassed=!0,cc.systemEvent.emit(c.default.stageStart,t),t.isBoss&&(yield this.effectController.playSingleEffect(d.SingleEffect.boss)),this.enemyController.letEnemiesOut(t.enemies)})}gameStart(){return i(this,void 0,void 0,function*(){this.startStage(),this.baseController.startAutoGenerateSeed()})}onGameReady(){h.default.getInstance().playSound(h.SoundId.enemyEnter),this.gameStart()}};return e.ins=null,n([m(a.default)],e.prototype,"enemyController",void 0),n([m(l.default)],e.prototype,"bulletController",void 0),n([m(r.default)],e.prototype,"baseController",void 0),n([m(d.default)],e.prototype,"effectController",void 0),e=t=n([g],e)})();o.default=y,cc._RF.pop()},{"../common/SoundsController":"SoundsController","../common/data/UserDataManager":"UserDataManager","../common/platform/PlatformUtils":"PlatformUtils","./BattleEvent":"BattleEvent","./Configs":"Configs","./UI/dialog/DialogManager":"DialogManager","./bullet/BulletController":"BulletController","./effect/EffectController":"EffectController","./enemy/EnemyController":"EnemyController","./tower/BaseController":"BaseController"}],BattleEvent:[function(t,e,o){"use strict";var n;cc._RF.push(e,"bb195vne89I445kn4kzpojW","BattleEvent"),Object.defineProperty(o,"__esModule",{value:!0}),function(t){t.gameStart="game_start",t.enemyEscaped="enemy_escaped",t.enemyKilled="enemy_killed",t.enemyRemoved="enemy_removed",t.enemyAllRemoved="enemy_all_removed",t.fire="fire",t.hit="hit",t.updateCoins="update_coins",t.updateDiamonds="update_diamonds",t.updateMaxTowerLevel="update_max_tower_level",t.playGainCoinsAnimation="play_gain_coins_animation",t.playGainDiamondsAnimation="play_gain_diamonds_animation",t.towerGrow="tower_grow",t.towerUpdate="tower_update",t.tryBuyTower="try_buy_tower",t.tryAddSeedTower="try_add_seed_tower",t.speedUp="speed_up",t.stageStart="stage_start",t.tryShowBalloon="try_show_balloon",t.stagePassSuccess="stage_pass_success",t.stagePassFailed="stage_pass_failed",t.stageBossCome="stage_boss_come",t.gameReady="game_ready",t.userDataLoaded="user_data_loaded",t.gotTowerUnlockReward="got_tower_unlock_reward"}(n||(n={})),o.default=n,cc._RF.pop()},{}],BattleUI:[function(t,e,o){"use strict";cc._RF.push(e,"c849btuw9lBc4m82rVYF8Zz","BattleUI");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../../common/data/UserDataManager"),a=t("../dialog/DialogManager"),l=t("../../../common/SoundsController"),c=t("../../../common/i18n/i18n"),{ccclass:r,property:d}=cc._decorator;let u=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.btnBuy=null,this.btnShop=null,this.btnSettings=null,this.btnRank=null,this.btnSign=null,this.btnExit=null}onLoad(){this.btnShop.node.on("click",this.onOpenShop,this),this.btnSettings.node.on("click",this.onOpenSettings,this),this.btnRank.node.on("click",this.onOpenRank,this),this.btnSign.node.on("click",this.onOpenSign,this),this.btnExit.node.on("click",this.onExit,this)}onExit(){return i(this,void 0,void 0,function*(){this.playClickSound(),(yield a.default.getInstance().showOptionDialog(c.i18n.get("confirmQuit")))&&(s.default.getInstance().clear(),cc.sys.isNative&&cc.director.end())})}playClickSound(){l.default.getInstance().playSound(l.SoundId.click)}onOpenShop(){this.playClickSound(),a.default.getInstance().showDialog(a.DialogType.shop)}onOpenSettings(){this.playClickSound(),a.default.getInstance().showDialog(a.DialogType.settings)}onOpenRank(){this.playClickSound(),a.default.getInstance().showDialog(a.DialogType.balloon)}onOpenSign(){this.playClickSound(),a.default.getInstance().showDialog(a.DialogType.sign)}};return n([d(cc.Button)],t.prototype,"btnBuy",void 0),n([d(cc.Button)],t.prototype,"btnShop",void 0),n([d(cc.Button)],t.prototype,"btnSettings",void 0),n([d(cc.Button)],t.prototype,"btnRank",void 0),n([d(cc.Button)],t.prototype,"btnSign",void 0),n([d(cc.Button)],t.prototype,"btnExit",void 0),t=n([r],t)})();o.default=u,cc._RF.pop()},{"../../../common/SoundsController":"SoundsController","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../dialog/DialogManager":"DialogManager"}],BulletController:[function(t,e,o){"use strict";cc._RF.push(e,"7477aGO6ThAKaiLG3BaCxkf","BulletController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("./BulletFactory"),s=t("../BattleEvent"),{ccclass:a,property:l}=cc._decorator;let c=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.bulletPrefab=null}onLoad(){i.default.getInstance().init(this.bulletPrefab),cc.systemEvent.on(s.default.fire,this.onTowerFire,this)}onTowerFire(t){let e=i.default.getInstance().get(t.config);this.addBullet(e,t)}addBullet(t,e){e.target?(this.node.addChild(t.node),t.fired(this.node.convertToNodeSpaceAR(e.ptMuzzle),e.target)):console.log("\u6ca1\u6709\u5bf9\u8c61\u7684\u5b50\u5f39")}};return n([l(cc.Prefab)],t.prototype,"bulletPrefab",void 0),t=n([a],t)})();o.default=c,cc._RF.pop()},{"../BattleEvent":"BattleEvent","./BulletFactory":"BulletFactory"}],BulletFactory:[function(t,e,o){"use strict";cc._RF.push(e,"fb456pifnpORoE3ZTj1vt73","BulletFactory"),Object.defineProperty(o,"__esModule",{value:!0});const n=t("./Bullet");class i{constructor(){this.itemPrefab=null}static getInstance(){return this.ins||(this.ins=new i),this.ins}init(t){this.itemPrefab=t,this.pool=new cc.NodePool}get(t){let e,o=(e=this.pool.size()>0?this.pool.get():cc.instantiate(this.itemPrefab)).getComponent(n.default);return o.init(t),o}put(t){t.node.removeFromParent(!1),this.pool.put(t.node)}}o.default=i,cc._RF.pop()},{"./Bullet":"Bullet"}],Bullet:[function(t,e,o){"use strict";cc._RF.push(e,"b7ff00ZSkRNRYKJ57zu1Q2H","Bullet");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../common/AssetsManager"),a=t("./BulletFactory"),l=t("../Configs"),c=t("../BattleEvent"),r=t("../BattleController"),d=t("../../common/SoundsController"),{ccclass:u,property:h}=cc._decorator;let p=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.sp=null,this.trail=null}onLoad(){this.node.scale=.6,cc.systemEvent.on(c.default.enemyRemoved,this.onEnemyRemove,this)}onEnemyRemove(t){this.target===t&&this.findNextTarget()}findNextTarget(){let t=r.default.getInstance().getAllEnemies();if(this.target=null,t.length>0){let e=500;t.forEach(t=>{if(t.dead||!t.node.parent)return;let o=this.node.getPosition().sub(t.getAttackedPoint()).mag();o<e&&(e=o,this.target=t)})}this.target||this.dispose()}init(t){return i(this,void 0,void 0,function*(){this.config=t,this.sp.spriteFrame=yield s.default.getInstance().getBulletSpriteFrame(this.config.level),this.trail.color=l.default.getTrailColor(this.config.level),this.trail.stroke=.6*this.sp.node.height})}onHit(){this.target.onHit(this.config.power);let t=!1,e=this.config.power;if(Math.random()<this.config.skillProbability)switch(this.config.skillType){case l.AttackBuff.critical:t=!0,e*=2,d.default.getInstance().playSound(d.SoundId.critical);break;case l.AttackBuff.slow:this.target.slow(2),d.default.getInstance().playSound(d.SoundId.slow);break;case l.AttackBuff.stun:d.default.getInstance().playSound(d.SoundId.stun),this.target.stun(1)}else d.default.getInstance().playSound(d.SoundId.hit);let o={target:this.target,power:this.config.power,critical:t};cc.systemEvent.emit(c.default.hit,o),this.dispose()}fired(t,e){this.node.setPosition(t),this.setTarget(e)}setTarget(t){this.target=t}dispose(){this.target=null,this.sp.spriteFrame=null,a.default.getInstance().put(this)}update(t){if(this.target&&this.target.dead&&this.findNextTarget(),!this.target)return;let e=this.target.getAttackedPoint(),o=this.node.getPosition(),n=e.sub(o);n.mag()<650*t?this.onHit():(this.node.angle=Math.atan2(n.y,n.x)/Math.PI*180-180,n.normalizeSelf().mulSelf(650*t),this.node.x+=n.x,this.node.y+=n.y)}};return n([h(cc.Sprite)],t.prototype,"sp",void 0),n([h(cc.MotionStreak)],t.prototype,"trail",void 0),t=n([u],t)})();o.default=p,cc._RF.pop()},{"../../common/AssetsManager":"AssetsManager","../../common/SoundsController":"SoundsController","../BattleController":"BattleController","../BattleEvent":"BattleEvent","../Configs":"Configs","./BulletFactory":"BulletFactory"}],Configs:[function(t,e,o){"use strict";cc._RF.push(e,"a270dBOTepIcZbzHOyK1y/p","Configs");var n=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.AttackBuff=o.EnemyConfig=o.StageConfig=o.TowerConfig=o.LoadConfig=void 0;const i=t("../common/AssetsManager");let s=(()=>{class t{static init(){return n(this,void 0,void 0,function*(){return Promise.all([this.loadTowerConfig(),this.loadLevelConfig(),this.loadEnemyConfig()])})}static initPaths(t){this.paths=t,this.totalDistance=0;for(let e=1;e<t.length;e++)this.totalDistance+=t[e].sub(t[e-1]).mag()}static loadTowerConfig(){return n(this,void 0,void 0,function*(){this.towerConfigs=new Map,(yield i.default.getInstance().getTowerConfig()).json.map(t=>{let e=new l(t);this.towerConfigs[e.level]=e})})}static loadEnemyConfig(){return n(this,void 0,void 0,function*(){this.enemyConfigs=new Map,(yield i.default.getInstance().getEnemyConfig()).json.forEach(t=>{let e=new r(t);this.enemyConfigs[e.id]=e})})}static loadLevelConfig(){return n(this,void 0,void 0,function*(){this.stageConfigs=new Map,(yield i.default.getInstance().getStageConfig()).json.forEach(t=>{let e=new c(t),o=this.stageConfigs[e.mainLevel];o||(o=this.stageConfigs[e.mainLevel]=[]),o[e.subLevel-1]=e})})}static getTrailColor(t){return a[Math.floor(t%a.length)-1]}}return t.unlockCost={0:1e3,5:1e3,6:15e3,7:156500,8:737850,9:3441630,10:1767e4,11:3069e4},t.maxTowerLevel=30,t.maxStageLevel=200,t.speedUpDuration=30,t.dayMilliseconds=864e5,t.ticketFreeGotInterval=3600,t.maxTicketGotPerDay=10,t.totalTicketCountLimit=10,t})();o.default=s,o.LoadConfig={balloon:1,balloonLevel:5,balloonTimes:10,freeCoinsTimes:5,freeDiamondsTimes:5,lotteryLevel:5,lotteryChance:[.05,.35,.6]};let a=[cc.color().fromHEX("#fdf3d4"),cc.color().fromHEX("#f4d975"),cc.color().fromHEX("#c34238"),cc.color().fromHEX("#f37c49"),cc.color().fromHEX("#f8ed80"),cc.color().fromHEX("#ee9524"),cc.color().fromHEX("#dbc286"),cc.color().fromHEX("#afd635"),cc.color().fromHEX("#e12110"),cc.color().fromHEX("#e69e15"),cc.color().fromHEX("#b8e9ad"),cc.color().fromHEX("#f24628"),cc.color().fromHEX("#f65555"),cc.color().fromHEX("#99c324"),cc.color().fromHEX("#fee560"),cc.color().fromHEX("#bdee54"),cc.color().fromHEX("#fbe2bd"),cc.color().fromHEX("#ffe4a0"),cc.color().fromHEX("#9d4c97"),cc.color().fromHEX("#f0cf00"),cc.color().fromHEX("#af136b"),cc.color().fromHEX("#95eb9f"),cc.color().fromHEX("#75dea0"),cc.color().fromHEX("#9d70fa"),cc.color().fromHEX("#afddef"),cc.color().fromHEX("#ff7d43"),cc.color().fromHEX("#ab4400"),cc.color().fromHEX("#74aef5"),cc.color().fromHEX("#aed321"),cc.color().fromHEX("#ff5d47")];class l{constructor(t){this.level=t[0],this.skillType=t[1],this.skillProbability=t[2]/100,this.unlockBonus=t[3],this.power=t[4],this.cd=t[5],this.distance=t[6],this.scale=t[7]}}o.TowerConfig=l;class c{constructor(t){if(this.isBoss=!1,!t||0===t.length)return;this.id=t[0],this.mainLevel=t[1],this.subLevel=t[2],this.offlineCoins=t[3],this.winCoins=t[4],this.lostCoins=t[5];let e=t[6].toString();this.enemies=e.split(",").map(t=>parseInt(t)),this.isBoss=5==this.subLevel}}o.StageConfig=c;class r{constructor(t){this.id=t[0],this.hp=t[1],this.speed=t[2],this.coin=t[3],this.model=t[4].toString(),this.scale=t[5]}}o.EnemyConfig=r,function(t){t[t.normal=0]="normal",t[t.slow=1]="slow",t[t.critical=2]="critical",t[t.stun=3]="stun"}(o.AttackBuff||(o.AttackBuff={})),cc._RF.pop()},{"../common/AssetsManager":"AssetsManager"}],CustomNodePool:[function(t,e,o){"use strict";cc._RF.push(e,"09222/pZO5J4LofGBhMb1S6","CustomNodePool"),cc._RF.pop()},{}],DialogManager:[function(t,e,o){"use strict";cc._RF.push(e,"2fb6f/8OL5FKoJGAh3QKq2h","DialogManager");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.DialogType=void 0;const s=t("../../../common/AssetsManager"),a=t("./dialog"),{ccclass:l,property:c}=cc._decorator;var r;(function(t){t.sign="sign",t.offlineCoins="offlineCoins",t.doubleApply="double",t.shop="shop",t.lackedToken="lacked",t.lottery="lottery",t.settings="settings",t.newTowerLevel="newLevelTower",t.speedUp="speedUp",t.passMainStage="passMainStage",t.option="option",t.balloon="balloon"})(r=o.DialogType||(o.DialogType={}));let d=(()=>{var t;let e=t=class extends cc.Component{static getInstance(){return this.ins}onLoad(){t.ins=this}showDialog(t,e=null,o=null){return i(this,void 0,void 0,function*(){console.log("open dialog:",t,"data:",e);let n=yield s.default.getInstance().getDialog(t),i=cc.instantiate(n);i.setPosition(0,0);let l=i.getComponent(a.default);this.node.addChild(i),l.setCloseCB(o),l.show(e)})}showOptionDialog(t){return i(this,void 0,void 0,function*(){return new Promise(e=>{this.showDialog(r.option,t,e)})})}};return e=t=n([l],e)})();o.default=d,cc._RF.pop()},{"../../../common/AssetsManager":"AssetsManager","./dialog":"dialog"}],DragController:[function(t,e,o){"use strict";cc._RF.push(e,"9b538PJiG5E4rS7vc6fMeCg","DragController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./Tower"),a=t("../Configs"),l=t("../BattleEvent"),c=t("../../lib/components/Draggable"),r=t("./GuildHand"),d=t("../UI/main/SellController"),u=t("../UI/dialog/DialogManager"),h=t("../../common/i18n/i18n"),p=t("../../common/data/UserDataManager"),f=t("../../common/data/GameNumberUtils"),g=t("../guide/GuideController"),{ccclass:m,property:y}=cc._decorator;let v=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.guildHand=null,this.towers=[],this.sellController=null}init(t,e){this.towerBases=t,this.towerPrefab=e,this.towers=new Array(12),cc.systemEvent.on(l.default.towerUpdate,this.onTowerUpdate,this),cc.systemEvent.on(l.default.gameReady,this.onGameReady,this)}onGameReady(){this.guildHand.init(this.towerBases)}onTowerUpdate({index:t,level:e}){if(e>0){let o=a.default.towerConfigs[e];this.setTower(t,o)}else this.removeTower(t)}getTowerBase(t){return this.towerBases[this.towers.indexOf(t)]}onDragStart(t){let e=t.getComponent(s.default);e.setVisible(!0),this.getTowerBase(e).tower.setTranslucent(!0),this.showSameLevelBaseTips(e),this.sellController.showSell()}onDragEnd(t){this.guildHand.hideGuild();let e=this.towerBases.findIndex(e=>e.node.getBoundingBox().contains(t.getPosition())),o=this.towers.indexOf(t.getComponent(s.default)),n=t.getBoundingBoxToWorld();if(this.putBackTowerNode(t),this.towerBases.forEach(t=>t.showSameLevelTips(!1)),p.default.getInstance().isNewUser)return this.sellController.hideSell(),void(-1!=e&&o!==e&&this.handleTowerBaseSwap(o,e));this.sellController.isInSell(n)?this.askSell(this.towerBases[o]):-1!=e&&o!==e&&this.handleTowerBaseSwap(o,e),this.sellController.hideSell()}askSell(t){return i(this,void 0,void 0,function*(){let e=f.default.getInstance().getTowerSellingPrice(t.towerLevel);(yield u.default.getInstance().showOptionDialog(h.i18n.getFormat("sellTowerTips",h.i18n.getNumberString(e))))&&(p.default.getInstance().addCoins(e),t.sell())})}handleTowerBaseSwap(t,e){let o=this.towerBases[t],n=this.towerBases[e];if(!n.locked)if(n.hasTower)if(o.towerLevel===n.towerLevel){if(!g.default.getInstance().validTowerDrag(t,e))return;n.levelUpTower(),o.removeTower()}else{let t=n.towerLevel;n.setTower(o.towerLevel),o.setTower(t)}else{if(console.log(t,e),!g.default.getInstance().validTowerDrag(t,e))return;n.setTower(o.towerLevel),o.removeTower()}}putBackTowerNode(t){let e=t.getComponent(s.default),o=this.getTowerBase(e);t.setPosition(o.node.getPosition()),e.setVisible(!1),o.tower.setTranslucent(!1)}showSameLevelBaseTips(t){let e=this.towers.indexOf(t);this.towerBases.forEach(o=>{e!=o.index&&o.hasTower&&o.towerLevel===t.level&&o.showSameLevelTips(!0)})}removeTower(t){let e=this.towers[t];e&&(e.node.active=!1)}setTower(t,e){let o=this.towers[t];if(!o){let e=cc.instantiate(this.towerPrefab);this.node.addChild(e),o=e.getComponent(s.default),this.towers[t]=o,o.addComponent(c.default),o.node.on(c.DragEvents.start,this.onDragStart,this),o.node.on(c.DragEvents.end,this.onDragEnd,this)}o.node.active=!0;let n=this.towerBases[t];o.init(e),o.setVisible(!1),o.node.setPosition(n.node.getPosition())}};return n([y(r.default)],t.prototype,"guildHand",void 0),n([y(d.default)],t.prototype,"sellController",void 0),t=n([m],t)})();o.default=v,cc._RF.pop()},{"../../common/data/GameNumberUtils":"GameNumberUtils","../../common/data/UserDataManager":"UserDataManager","../../common/i18n/i18n":"i18n","../../lib/components/Draggable":"Draggable","../BattleEvent":"BattleEvent","../Configs":"Configs","../UI/dialog/DialogManager":"DialogManager","../UI/main/SellController":"SellController","../guide/GuideController":"GuideController","./GuildHand":"GuildHand","./Tower":"Tower"}],Draggable:[function(t,e,o){"use strict";cc._RF.push(e,"e962eYYegxI7p/oQfaYql9j","Draggable");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.DragEvents=void 0,o.DragEvents={start:"drag_start",end:"drag_end",cancel:"drag_cancel",dragging:"dragging"};const{ccclass:i,property:s}=cc._decorator;let a=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.target=null,this._isDragging=!1,this.dragRect=null,this.onDragStart=null,this.onDragging=null,this.onDragEnd=null,this.onDragCancel=null}onLoad(){this.target=this.target||this.node}onEnable(){this._setTouchStartEnable(!0)}onDisable(){this._setTouchStartEnable(!1),this._setTouchOtherEnable(!1),this._isDragging&&this._onTouchCancel(null)}onDestroy(){this._setTouchStartEnable(!1),this._setTouchOtherEnable(!1),this.onDragCancel=null,this.onDragEnd=null}_onTouchStart(t){this._isDragging=!0,t.stopPropagation(),this._setTouchOtherEnable(!0),this.onDragStart&&this.onDragStart(this.node.getPosition()),this.node.emit(o.DragEvents.start,this.node)}_onTouchMove(t){const e=t.getDelta();this.target.x+=e.x,this.target.y+=e.y,this.dragRect&&(this.target.x<this.dragRect.xMin?this.target.x=this.dragRect.xMin:this.target.x>this.dragRect.xMax&&(this.target.x=this.dragRect.xMax),this.target.y<this.dragRect.yMin?this.target.y=this.dragRect.yMin:this.target.y>this.dragRect.yMax&&(this.target.y=this.dragRect.yMax)),t.stopPropagation(),this.onDragging&&this.onDragging(this.node.getPosition()),this.node.emit(o.DragEvents.dragging,this.node)}_onTouchEnd(){this.onDragEnd&&this.onDragEnd(this.node.getPosition()),this.node.emit(o.DragEvents.end,this.node),this._setTouchOtherEnable(!1),this._isDragging=!1}_onTouchCancel(t){this.onDragCancel&&this.onDragCancel(this.node.getPosition()),this.node.emit(o.DragEvents.cancel,this.node),this._setTouchOtherEnable(!1),this._isDragging=!1}_setTouchStartEnable(t){t?this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this):this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStart,this)}_setTouchOtherEnable(t){t?(this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)):(this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this))}};return n([s(cc.Node)],t.prototype,"target",void 0),t=n([i],t)})();o.default=a,cc._RF.pop()},{}],EffectController:[function(t,e,o){"use strict";cc._RF.push(e,"abcc8ZNjy5J5p1DkQ/qrkUQ","EffectController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.SingleEffect=void 0;const s=t("./EffectFactory"),a=t("../BattleEvent"),l=t("../../common/GameUtils"),c=t("../../common/AssetsManager");var r=cc.WrapMode;const{ccclass:d,property:u}=cc._decorator;let h=700,p=800,f=900,g=1e3,m=9999,y=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.effectFactory=null,this.mask=null,this.highEffectLayer=null,this.singleEffectMap=new Map}onLoad(){this.initEventListen()}initEventListen(){cc.systemEvent.on(a.default.hit,this.onEnemyHit,this),cc.systemEvent.on(a.default.enemyKilled,this.onEnemyKilled,this)}onEnemyHit({target:t,power:e,critical:o}){o&&this.playCriticalAnimation(t),this.playNormalHitAnimation(t)}onEnemyKilled(t){return i(this,void 0,void 0,function*(){this.playEnemyDeadAnimation(t),this.playKillRewardAnimation(t)})}playCriticalAnimation(t){let e=t.getAttackedPoint(),o=this.effectFactory.getCritical();this.node.addChild(o);let n=[];o.setPosition(e),o.zIndex=p,n.push(cc.moveBy(1,0,80)),n.push(cc.callFunc(this.effectFactory.putCritical.bind(this.effectFactory,o))),o.runAction(cc.sequence(n))}playEnemyDeadAnimation(t){return i(this,void 0,void 0,function*(){let e=t.getAttackedPoint(),o=this.effectFactory.getDeath();o.setPosition(e),o.zIndex=f,yield l.default.delay(.2),this.node.addChild(o);let n=o.getComponent(cc.Animation);yield l.default.playOnceAnimation(n),this.effectFactory.putDeath(o)})}playKillRewardAnimation(t){let e=t.getAttackedPoint(),o=this.effectFactory.getKillReward();o.getComponent(cc.Label).string="+"+t.config.coin,this.node.addChild(o);let n=[];o.setPosition(e),o.zIndex=g,n.push(cc.moveBy(1,0,80)),n.push(cc.callFunc(this.effectFactory.putKillReward.bind(this.effectFactory,o))),o.runAction(cc.sequence(n))}playNormalHitAnimation(t){return i(this,void 0,void 0,function*(){let e=t.getAttackedPoint(),o=this.effectFactory.getHitEffect();o.scale=.7,o.setPosition(e),o.zIndex=h,this.node.addChild(o);let n=o.getComponent(cc.Animation);yield l.default.playOnceAnimation(n),this.effectFactory.putHitEffect(o)})}playSingleEffect(t,e=0){return i(this,void 0,void 0,function*(){let e=this.singleEffectMap[t];if(!e){let o=yield c.default.getInstance().loadAsset(`effect/${t}/${t}`,cc.Prefab),n=cc.instantiate(o);t===v.boss?this.highEffectLayer.addChild(n):this.node.addChild(n),e=n.getComponent(cc.Animation),this.singleEffectMap[t]=e}t===v.boss&&(e.scale=cc.visibleRect.width/720,console.log("effect.scale:",e.scale),this.highEffectLayer.active=!0),e.node.active=!0,yield l.default.playOnceAnimation(e),e.node.active=!1,this.highEffectLayer.active=!1,this.mask.active=!1})}showSpeedUp(t){return i(this,void 0,void 0,function*(){let e=v.speedUp,o=this.singleEffectMap[e];if(t){if(!o){console.log("show speed up");let t=yield c.default.getInstance().loadAsset(`effect/${e}/${e}`,cc.Prefab),n=cc.instantiate(t);this.node.addChild(n),n.scaleX=cc.visibleRect.width/n.width,n.scaleY=cc.visibleRect.height/n.height,n.zIndex=m,o=n.getComponent(cc.Animation),this.singleEffectMap[e]=o}o.node.active=!0,o.play(null,0).wrapMode=r.Loop}else o&&(o.stop(),o.node.active=!1)})}};return n([u(s.default)],t.prototype,"effectFactory",void 0),n([u(cc.Node)],t.prototype,"mask",void 0),n([u(cc.Node)],t.prototype,"highEffectLayer",void 0),t=n([d],t)})();var v;o.default=y,function(t){t.victory="victory",t.failed="fail",t.boss="boss",t.speedUp="speedUp"}(v=o.SingleEffect||(o.SingleEffect={})),cc._RF.pop()},{"../../common/AssetsManager":"AssetsManager","../../common/GameUtils":"GameUtils","../BattleEvent":"BattleEvent","./EffectFactory":"EffectFactory"}],EffectFactory:[function(t,e,o){"use strict";cc._RF.push(e,"3514dhDxbhCm6sg5OP4yEWc","EffectFactory");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.EffectType=void 0;const i=t("../../common/SimpleNodePool"),{ccclass:s,property:a}=cc._decorator;(function(t){t.coin="coin",t.diamond="diamond",t.critical="critical",t.hit="hit",t.death="death",t.stun="stun"})(o.EffectType||(o.EffectType={}));let l=(()=>{var t;let e=t=class extends cc.Component{constructor(){super(...arguments),this.coinPrefab=null,this.diamondPrefab=null,this.criticalPrefab=null,this.hitPrefab=null,this.deathPrefab=null,this.stunPrefab=null,this.lvUpPrefab=null,this.killRewardPrefab=null}static getInstance(){return this.ins}onLoad(){t.ins=this,this.coinPool=new i.default(this.coinPrefab),this.diamondPool=new i.default(this.diamondPrefab),this.criticalPool=new i.default(this.criticalPrefab),this.hitPool=new i.default(this.hitPrefab),this.deathPool=new i.default(this.deathPrefab),this.stunPool=new i.default(this.stunPrefab),this.lvUpPool=new i.default(this.lvUpPrefab),this.killRewardPool=new i.default(this.killRewardPrefab)}getKillReward(){return this.killRewardPool.get()}putKillReward(t){return this.killRewardPool.put(t)}getLvUp(){return this.lvUpPool.get()}putLvUp(t){this.lvUpPool.put(t)}getStun(){return this.stunPool.get()}putStun(t){this.stunPool.put(t)}getDeath(){return this.deathPool.get()}putDeath(t){this.deathPool.put(t)}getCoin(){return this.coinPool.get()}putCoin(t){this.coinPool.put(t)}getDiamond(){return this.diamondPool.get()}putDiamond(t){this.diamondPool.put(t)}getCritical(){return this.criticalPool.get()}putCritical(t){this.criticalPool.put(t)}getHitEffect(){return this.hitPool.get()}putHitEffect(t){this.hitPool.put(t)}};return n([a(cc.Prefab)],e.prototype,"coinPrefab",void 0),n([a(cc.Prefab)],e.prototype,"diamondPrefab",void 0),n([a(cc.Prefab)],e.prototype,"criticalPrefab",void 0),n([a(cc.Prefab)],e.prototype,"hitPrefab",void 0),n([a(cc.Prefab)],e.prototype,"deathPrefab",void 0),n([a(cc.Prefab)],e.prototype,"stunPrefab",void 0),n([a(cc.Prefab)],e.prototype,"lvUpPrefab",void 0),n([a(cc.Prefab)],e.prototype,"killRewardPrefab",void 0),e=t=n([s],e)})();o.default=l,cc._RF.pop()},{"../../common/SimpleNodePool":"SimpleNodePool"}],EnemyController:[function(t,e,o){"use strict";cc._RF.push(e,"90b6685uDBNN7Ag5RTUHMh5","EnemyController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../Configs"),a=t("./EnemyFactory"),l=t("../../common/GameUtils"),c=t("../BattleEvent"),r=t("../../lib/ArrayUtils"),{ccclass:d,property:u}=cc._decorator;let h=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.enemyPrefab=null,this.leftEnemyCount=0}onLoad(){this.initEventListen(),this.initPaths(),this.clear()}clear(){this.enemies=[]}initPaths(){a.default.getInstance().init(this.enemyPrefab);let t=this.node.children.concat().map(t=>(t.removeFromParent(!0),t.getPosition()));s.default.initPaths(t)}addItem(t){this.enemies.push(t),this.node.addChild(t.node),t.startWalk()}getAll(){return this.enemies}deepExchange(){let t=this.node.children;t.length<2||t.sort((t,e)=>e.y-t.y)}update(t){this.deepExchange()}initEventListen(){cc.systemEvent.on(c.default.enemyRemoved,this.onEnemyRemove,this)}onEnemyRemove(t){r.default.remove(this.enemies,t),--this.leftEnemyCount,this.leftEnemyCount<=0&&cc.systemEvent.emit(c.default.enemyAllRemoved)}letEnemiesOut(t){return i(this,void 0,void 0,function*(){this.leftEnemyCount=t.length;for(let e=0;e<t.length;e++){let o=t[e];if(isNaN(o)){--this.leftEnemyCount,console.log("stage config error!");continue}yield l.default.delay(1.5);let n=s.default.enemyConfigs[o],i=a.default.getInstance().get(n);this.addItem(i)}})}};return n([u(cc.Prefab)],t.prototype,"enemyPrefab",void 0),t=n([d],t)})();o.default=h,cc._RF.pop()},{"../../common/GameUtils":"GameUtils","../../lib/ArrayUtils":"ArrayUtils","../BattleEvent":"BattleEvent","../Configs":"Configs","./EnemyFactory":"EnemyFactory"}],EnemyFactory:[function(t,e,o){"use strict";cc._RF.push(e,"227d5aFq/JNGpgO0KJw9yFH","EnemyFactory"),Object.defineProperty(o,"__esModule",{value:!0});const n=t("./Enemy");class i{constructor(){this.itemPrefab=null}static getInstance(){return this.ins||(this.ins=new i),this.ins}init(t){this.itemPrefab=t,this.pool=new cc.NodePool}get(t){let e,o=(e=this.pool.size()>0?this.pool.get():cc.instantiate(this.itemPrefab)).getComponent(n.default);return o.init(t),o}put(t){t.node.removeFromParent(!1),this.pool.put(t.node)}}o.default=i,cc._RF.pop()},{"./Enemy":"Enemy"}],Enemy:[function(t,e,o){"use strict";cc._RF.push(e,"d174eohdEpIe5ioVhuzW1Gb","Enemy");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../common/AssetsManager"),a=t("../Configs"),l=t("./EnemyFactory"),c=t("../../lib/NumberAction"),r=t("../BattleEvent"),d=t("../effect/EffectFactory"),u=t("../../common/data/UserDataManager"),{ccclass:h,property:p}=cc._decorator;let f=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.display=null,this.hpNode=null,this.hpBar=null,this.hpAnimBar=null,this.stunEffect=null,this.hp=0,this.dir=cc.v2(),this.speed=0,this.progress=0,this.stunTime=0,this.slowTime=0,this.slowRatio=.4,this.dead=!0}init(t){return i(this,void 0,void 0,function*(){this.node.active=!1,this.config=t;let e=this.display;e.skeletonData=yield s.default.getInstance().getEnemySkeletonAssets(t.model),e.paused=!1,this.display.setAnimation(0,"run",!0),1==t.scale?e.node.scale=.4:e.node.scale=.3,this.updateHPPos(),this.hp=t.hp,this.hpAnimBar.progress=1,this.hpBar.progress=1,this.speed=a.default.totalDistance*t.speed,this.node.active=!0,this.dead=!1})}onLoad(){this.playDefaultAnimation()}onKilled(){cc.systemEvent.emit(r.default.enemyKilled,this),u.default.getInstance().addCoins(this.config.coin),this.dispose()}dispose(){this.dead=!0,l.default.getInstance().put(this),cc.systemEvent.emit(r.default.enemyRemoved,this),this.showSlowEffect(!1)}onHit(t){this.hp-=t,this.hp<=0?(this.hp=0,this.dead=!0,this.updateHP(.15,this.onKilled.bind(this))):this.updateHP(.4)}updateHP(t,e){let o=Math.max(0,this.hp),n=cc.misc.clamp01(o/this.config.hp);this.hpBar.progress=n,this.hpAnimBar.node.stopAllActions();let i=[];i.push(new c.default(t,this.hpAnimBar.progress,n,t=>{this.hpAnimBar.progress=t})),i.push(cc.callFunc(e)),this.hpAnimBar.node.runAction(cc.sequence(i))}updateHPPos(){if(!this.display)return;let t=this.display.node.scaleY,e=this.display.findBone("HP");e?(this.hpNode.x=this.display.node.x+e.x*t,this.hpNode.y=this.display.node.y+e.y*t+10):(console.log("no bond hp bone"),this.hpNode.x=this.display.node.x,this.hpNode.y=this.display.node.y+180*t+10),this.updateStunEffectPos()}updateStunEffectPos(){this.stunEffect.x=this.hpNode.x,this.stunEffect.y=this.hpNode.y-20}playDefaultAnimation(){this.display.setAnimation(0,"run",!0)}startWalk(){this.ptTargets=a.default.paths.concat(),this.node.setPosition(this.ptTargets.shift()),this.gotoNextTarget()}gotoNextTarget(){0!==this.ptTargets.length?(this.ptNextTarget=this.ptTargets.shift(),this.dir=this.ptNextTarget.sub(this.node.getPosition()).normalizeSelf(),this.dir.x<0&&this.dir.y>0&&(this.display.node.scaleX*=-1)):this.escape()}escape(){cc.systemEvent.emit(r.default.enemyEscaped,this),this.dispose()}getAttackedPoint(){let t,e=this.display,o=e.findBone("boom");return o?((t=cc.v2()).x=this.node.x+this.display.node.x+o.x*e.node.scaleX,t.y=this.node.y+this.display.node.y+o.y*e.node.scaleY):(t=this.node.getPosition()).y+=75,t}get realTimeSpeed(){let t=this.speed;return this.stunTime>0?t=0:this.showStunEffect(!1),this.slowTime>0?t*=this.slowRatio:this.showSlowEffect(!1),t}update(t){if(!this.dead){if(this.stunTime>0&&(this.stunTime-=t),this.slowTime>0&&(this.slowTime-=t),this.ptNextTarget.sub(this.node.getPosition()).mag()<this.realTimeSpeed*t)return this.node.setPosition(this.ptNextTarget),void this.gotoNextTarget();this.node.x+=this.dir.x*this.realTimeSpeed*t,this.node.y+=this.dir.y*this.realTimeSpeed*t}}slow(t){this.slowTime=t,this.showSlowEffect(!0)}stun(t){this.stunTime=t,this.showStunEffect(!0)}showStunEffect(t){if(this.display.paused=t,t){if(0===this.stunEffect.childrenCount){let t=d.default.getInstance().getStun();t.scale=this.config.scale,this.stunEffect.addChild(t),t.getComponent(cc.Animation).play().wrapMode=cc.WrapMode.Loop}}else{let t=this.stunEffect.children[0];t&&d.default.getInstance().putStun(t)}}showSlowEffect(t){t?(this.display.node.color=new cc.Color(128,128,255,255),this.display.timeScale=this.slowRatio):(this.display.node.color=cc.Color.WHITE,this.display.timeScale=1)}};return n([p(sp.Skeleton)],t.prototype,"display",void 0),n([p(cc.Node)],t.prototype,"hpNode",void 0),n([p(cc.ProgressBar)],t.prototype,"hpBar",void 0),n([p(cc.ProgressBar)],t.prototype,"hpAnimBar",void 0),n([p(cc.Node)],t.prototype,"stunEffect",void 0),t=n([h],t)})();o.default=f,cc._RF.pop()},{"../../common/AssetsManager":"AssetsManager","../../common/data/UserDataManager":"UserDataManager","../../lib/NumberAction":"NumberAction","../BattleEvent":"BattleEvent","../Configs":"Configs","../effect/EffectFactory":"EffectFactory","./EnemyFactory":"EnemyFactory"}],FitWidth:[function(t,e,o){"use strict";cc._RF.push(e,"15b05GyqChCqq7QZTyrGiX/","FitWidth");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("./constants"),{ccclass:s,property:a}=cc._decorator;let l=(()=>{let t=class extends cc.Component{start(){this.scheduleOnce(()=>{const t=cc.view.getVisibleSize();let e=t.width/i.Constants.designWidth;this.node.scale=e;let o=this.node.getComponent(cc.Widget);if(o){let n=t.height/i.Constants.designHeight;o.bottom*=n,o.top*=n,o.left*=e,o.right*=e}},0)}};return t=n([s],t)})();o.default=l,cc._RF.pop()},{"./constants":"constants"}],GameNumberUtils:[function(t,e,o){"use strict";cc._RF.push(e,"21523facTZCt5KXaJEZrVWm","GameNumberUtils"),Object.defineProperty(o,"__esModule",{value:!0});const n=t("./UserDataManager");let i=(()=>{class t{static getInstance(){return this.ins}getCoinsPrice(t){let e=n.default.getInstance().getCoinsBuyTimes(t);return Math.floor(this.getCoinsForTimes(t,e))}getDiamondsPrice(t){let e=n.default.getInstance().getDiamondsBuyTimes(t);return Math.floor(this.getDiamondsForTimes(t,e))}getCoinsForTimes(t,e){let o=1.07;return t>1&&(o=[1.12,1.14,1.2,1.18,1.16,1.22,1.24][(t-1)%7]),this.getOriginCoins(t)*Math.pow(o,e)}getDiamondsForTimes(t,e){return Math.floor(this.getOriginDiamonds(t)*Math.pow(1.2,e))}getOriginCoins(t){return t>5?25*Math.pow(2,t+3)*(t-5)*50*Math.pow(1.05,t-6):[100,2500,1e4,4e4,16e4][t-1]}getOriginDiamonds(t){return 5*t}getMaxVideoAdDiamonds(){let t=Math.max(1,n.default.getInstance().maxTowerLevel-3);return 2*this.getOriginDiamonds(t)}getMaxVideoAdCoins(){let t=Math.max(1,n.default.getInstance().maxTowerLevel-6);return 2*this.getOriginCoins(t)}getDiamondsForSignDay(t){return 25+5*t}getTowerSellingPrice(t){return Math.max(1,.5*this.getOriginCoins(t))}}return t.ins=new t,t})();o.default=i,cc._RF.pop()},{"./UserDataManager":"UserDataManager"}],GameUtils:[function(t,e,o){"use strict";cc._RF.push(e,"d96a2mrcORBWKVqSNvE6hIi","GameUtils");var n=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const i=t("./AssetsManager"),s=t("../battle/tower/Tower"),a=t("./data/UserDataManager"),l=t("../battle/BattleEvent"),c=t("../battle/UI/main/AlertBox");class r{static delay(t){return n(this,void 0,void 0,function*(){return new Promise(e=>{setTimeout(e,1e3*t)})})}static getNodeDistance(t,e){return t.getPosition().sub(e.getPosition()).mag()}static alert(t){console.log(t),c.default.show(t)}static playOnceAnimation(t){return n(this,void 0,void 0,function*(){return new Promise(e=>{t.play(null,0),t.once("finished",e)})})}static setTowerDisplay(t,e){return n(this,void 0,void 0,function*(){let o=t.getComponent(sp.Skeleton);if(!o)return void console.log("\u4e0d\u662fspine\u52a8\u753b\u8282\u70b9");let n=yield i.default.getInstance().getTowerSkeletonAssets(e);o.skeletonData=n,o.setAnimation(0,s.TowerActionType.idle,!0)})}static showGotTokenEffect(t,e){return n(this,void 0,void 0,function*(){t==a.TokenType.coin?cc.systemEvent.emit(l.default.playGainCoinsAnimation,e):cc.systemEvent.emit(l.default.playGainDiamondsAnimation,e),yield r.delay(1)})}static transferMs2Minute(t){return Math.ceil(t/6e4)}static transferMs2Days(t){return Math.ceil(t/6e4/60/24)}static getLessHourTimeString(t){let e=Math.floor(t/60).toString();1===e.length&&(e="0"+e);let o=(t%60).toString();return 1===o.length&&(o="0"+o),`${e}:${o}`}static getUrlParams(){if(!cc.sys.isBrowser)return{};if(null==this.urlParams){this.urlParams={};let t=window.location.href.split("?");if(t.length>1){t=t[1].split("&");for(let e=0;e<t.length;++e){let o=t[e].split("=");this.urlParams[o[0]]=o[1]}}}return this.urlParams}static randomInt(t,e){return Math.floor(t+Math.random()*(e-t+1))}static random(t,e){return t+Math.random()*(e-t)}static shuffleArray(t){let e,o,n=t.length;for(;0!==n;)o=Math.floor(Math.random()*n),e=t[n-=1],t[n]=t[o],t[o]=e;return t}}o.default=r,cc._RF.pop()},{"../battle/BattleEvent":"BattleEvent","../battle/UI/main/AlertBox":"AlertBox","../battle/tower/Tower":"Tower","./AssetsManager":"AssetsManager","./data/UserDataManager":"UserDataManager"}],GuideController:[function(t,e,o){"use strict";cc._RF.push(e,"183e8kQaVhLioOFXZ+S5Vik","GuideController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../common/i18n/i18n"),a=t("../BattleEvent"),l=t("../tower/BaseController"),c=t("../../common/data/UserDataManager"),r=t("../../common/GameUtils"),{ccclass:d,property:u}=cc._decorator;let h=(()=>{var t;let e=t=class extends cc.Component{constructor(){super(...arguments),this.hand=null,this.mask=null,this.lbTips=null,this.tipsTray=null,this.btnQuickButton=null,this.baseController=null,this.validStepDragIndex=0,this.validStepDropIndex=0}static getInstance(){return this.ins}onLoad(){t.ins=this,this.node.active=!1}show(){return i(this,void 0,void 0,function*(){return this.node.active=!0,new Promise(t=>{this.completeCallback=t,this.startGuide()})})}startGuide(){return i(this,void 0,void 0,function*(){yield this.startStep1(),yield this.startStep2(),yield this.startStep3(),yield this.startStep4(),yield this.startStep5(),yield this.startStep6(),yield this.startStep7(),this.endGuide()})}endGuide(){c.default.getInstance().isNewUser=!1,this.hideTips(),this.hideHand(),this.hideMask(),this.node.active=!1,this.completeCallback()}showMask(t,e,o,n=cc.Mask.Type.RECT){this.mask.node.active=!0,this.mask.enabled=!0,this.mask.type=n,this.mask.node.setPosition(t),this.mask.node.width=e,this.mask.node.height=o,this.mask.node.getComponentsInChildren(cc.Widget).forEach(t=>{t.enabled=!0})}hideMask(){this.mask.node.active=!1,this.mask.enabled=!1}startStep1(){return i(this,void 0,void 0,function*(){console.log("guide step1--------------------------------"),this.showQuickButtonTips(s.i18n.get("guideTips1")),yield this.listenCompleteEvent(a.default.towerUpdate),this.hideHand()})}startStep2(){return i(this,void 0,void 0,function*(){console.log("guide step2--------------------------------"),this.showQuickButtonTips(s.i18n.get("guideTips2")),yield this.listenCompleteEvent(a.default.towerUpdate),this.hideHand()})}startStep3(){return i(this,void 0,void 0,function*(){console.log("guide step3--------------------------------"),this.showCircleTips(s.i18n.get("guideTips3"),1,0),yield this.listenCompleteEvent(a.default.towerUpdate),this.hideMask(),this.hideHand(),this.hideTips(),yield r.default.delay(.5)})}startStep4(){return i(this,void 0,void 0,function*(){console.log("guide step4--------------------------------"),this.showTips(cc.v2(0,-480),s.i18n.get("guideTips4")),this.showHand(cc.v2(50,-220),cc.v2(0,-220)),yield this.listenCompleteEvent(a.default.gotTowerUnlockReward),this.hideHand(),this.hideTips()})}startStep5(){return i(this,void 0,void 0,function*(){console.log("guide step5--------------------------------"),this.showCircleTips(s.i18n.get("guideTips3"),0,3),yield this.listenCompleteEvent(a.default.towerUpdate),this.hideHand(),this.hideTips(),yield r.default.delay(.5)})}startStep6(){return i(this,void 0,void 0,function*(){console.log("guide step6--------------------------------"),this.showQuickButtonTips(s.i18n.get("guideTips6")),yield this.listenCompleteEvent(a.default.towerUpdate),this.hideHand()})}startStep7(){return i(this,void 0,void 0,function*(){console.log("guide step7--------------------------------"),this.showQuickButtonTips(s.i18n.get("guideTips7")),yield this.listenCompleteEvent(a.default.towerUpdate),this.hideHand()})}listenCompleteEvent(t,e){return i(this,void 0,void 0,function*(){return console.log("listenCompleteEvent",t),new Promise(o=>{cc.systemEvent.on(t,function n(i){console.log("guide eventListener"),e&&!e(i)||(cc.systemEvent.off(t,n,this),o())},this)})})}showCircleTips(t,e,o){this.setValidStepDragIndex(e,o);let n=this.getBasePos(e),i=this.getBasePos(o),s=n.add(i.sub(n).mulSelf(.5));s.y+=10,this.showTips(cc.v2(s.x,s.y+120),t),this.showMask(s,2.5*(i.x-n.x),3*(i.y-n.y),cc.Mask.Type.ELLIPSE),this.showHand(n,i,0)}getBasePos(t){let e=this.baseController.towerBases[t];return this.node.convertToNodeSpaceAR(e.node.convertToWorldSpaceAR(cc.v2()))}showQuickButtonTips(t){let e=this.node.convertToNodeSpaceAR(this.btnQuickButton.convertToWorldSpaceAR(cc.v2()));console.log("ptMask",e.x,e.y),this.showTips(cc.v2(e.x,e.y+80),t);let o=cc.visibleRect.width/720,n=this.btnQuickButton.width*o,i=this.btnQuickButton.height*o;this.showMask(e,n,i);let s=40*o,a=35*o;this.showHand(cc.v2(e.x+s,e.y+a),cc.v2(e.x-s,e.y+a))}showTips(t,e){this.tipsTray.active=!0,this.lbTips.string=e,this.tipsTray.x=t.x,this.tipsTray.y=t.y}hideTips(){this.tipsTray.active=!1}showHand(t,e,o=90){this.hand.active=!0,this.hand.angle=o,this.hand.runAction(cc.repeatForever(cc.sequence(cc.place(t),cc.moveTo(1,e))))}hideHand(){this.hand.stopAllActions(),this.hand.active=!1}setValidStepDragIndex(t,e){this.validStepDragIndex=t,this.validStepDropIndex=e}validTowerDrag(t,e){return!c.default.getInstance().isNewUser||this.validStepDragIndex==t&&this.validStepDropIndex==e}};return e.ins=null,n([u(cc.Node)],e.prototype,"hand",void 0),n([u(cc.Mask)],e.prototype,"mask",void 0),n([u(cc.Label)],e.prototype,"lbTips",void 0),n([u(cc.Node)],e.prototype,"tipsTray",void 0),n([u(cc.Node)],e.prototype,"btnQuickButton",void 0),n([u(l.default)],e.prototype,"baseController",void 0),e=t=n([d],e)})();o.default=h,cc._RF.pop()},{"../../common/GameUtils":"GameUtils","../../common/data/UserDataManager":"UserDataManager","../../common/i18n/i18n":"i18n","../BattleEvent":"BattleEvent","../tower/BaseController":"BaseController"}],GuildHand:[function(t,e,o){"use strict";cc._RF.push(e,"345ec9fFpZDroundhVnBsps","GuildHand");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:s}=cc._decorator;let a=(()=>{let t=class extends cc.Component{onLoad(){this.node.opacity=0}init(t){this.towerBases=t,this.schedule(()=>{let t=[];this.towerBases.forEach(e=>{if(e.towerLevel<1)return;let o=t[e.towerLevel];o||(o=t[e.towerLevel]=[]),o.push(e)});let e=0;if(t.forEach(t=>{t.length>1&&t[0].towerLevel>e&&(e=t[0].towerLevel)}),e>0){let o=t[e];this.showLevelUpGuild(o[0].node.getPosition(),o[1].node.getPosition())}},15)}showLevelUpGuild(t,e){let o=[];o.push(cc.repeat(cc.sequence(cc.callFunc(()=>{this.node.opacity=255,this.node.setPosition(t)}),cc.moveTo(.7,e),cc.fadeOut(.3)),3)),o.push(cc.callFunc(this.hideGuild,this)),this.node.runAction(cc.sequence(o))}hideGuild(){this.node.stopAllActions(),this.node.opacity=0}};return t=n([i],t)})();o.default=a,cc._RF.pop()},{}],IconLabel:[function(t,e,o){"use strict";cc._RF.push(e,"e1a48kHeXBFRI9MTNINRXuv","IconLabel");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("../../lib/components/AComponent"),{ccclass:s,property:a}=cc._decorator;let l=(()=>{let t=class extends i.default{constructor(){super(...arguments),this.icon=null,this.label=null}set string(t){this.label.string=t,this.scheduleOnce(()=>{let t=this.icon.scale*this.icon.width;this.label.node.x=.5*t,this.icon.x=this.label.node.x-.5*this.label.node.width-.5*t-5},0)}set color(t){this.label.node.color=t}};return n([a(cc.Node)],t.prototype,"icon",void 0),n([a(cc.Label)],t.prototype,"label",void 0),t=n([s],t)})();o.default=l,cc._RF.pop()},{"../../lib/components/AComponent":"AComponent"}],LackedToken:[function(t,e,o){"use strict";cc._RF.push(e,"c09fb78e6hMbKZgSHICiA4Z","LackedToken");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),a=t("../../../common/data/UserDataManager"),l=t("../../../common/i18n/i18n"),c=t("../../Configs"),r=t("../AdsController"),d=t("./DialogManager"),u=t("../../BattleEvent"),h=t("../../../common/GameUtils"),p=t("../../../common/data/GameNumberUtils"),f=t("../IconLabel"),{ccclass:g,property:m}=cc._decorator;let y=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.btnVideo=null,this.diamondNode=null,this.coinNode=null,this.tokenAmount=0}onLoad(){super.onLoad(),this.init()}init(){this.btnVideo.node.on("click",this.onOpenVideo,this);let t=this.getLabel("lbTitleTips",this.coinNode);t.string=l.i18n.get("lackedCoinTitleTips"),(t=this.getLabel("lbTitleTips",this.diamondNode)).string=l.i18n.get("lackedDiamondTitleTips")}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){this.initData(t),e.show.call(this,t)})}initData({type:t,expectedAmount:e}){if(this.type=t,t==a.TokenType.coin){this.coinNode.active=!0,this.diamondNode.active=!1,this.updateTips(a.default.getInstance().getDrawVideoAdCoinCount(),c.LoadConfig.freeCoinsTimes),this.tokenAmount=Math.min(e,p.default.getInstance().getMaxVideoAdCoins()),this.coinNode.getComponent(f.default).string=l.i18n.getNumberString(this.tokenAmount)}else{this.coinNode.active=!1,this.diamondNode.active=!0,this.updateTips(a.default.getInstance().getDrawVideoAdDiamondCount(),c.LoadConfig.freeCoinsTimes),this.tokenAmount=Math.min(e,p.default.getInstance().getMaxVideoAdDiamonds()),this.diamondNode.getComponent(f.default).string=l.i18n.getNumberString(this.tokenAmount)}}updateTips(t,e){let o=this.getLabel("tray/lbTips"),n=Math.max(0,e-t);o.string=l.i18n.getFormat("lackedTips",n,e),this.btnVideo.interactable=e>t,console.log(this.btnVideo.interactable)}onOpenVideo(){return i(this,void 0,void 0,function*(){this.playClickSound(),(yield r.default.getInstance().showVideo())&&(this.btnVideo.interactable=!1,yield this.showGotTokenEffect(this.type,this.tokenAmount),yield this.hide(),d.default.getInstance().showDialog(d.DialogType.doubleApply,{type:this.type,amount:this.tokenAmount}))})}showGotTokenEffect(t,e){return i(this,void 0,void 0,function*(){t==a.TokenType.coin?(a.default.getInstance().updateGetVideoAdCoinTime(),cc.systemEvent.emit(u.default.playGainCoinsAnimation,e)):(a.default.getInstance().updateGetVideoAdDiamondTime(),cc.systemEvent.emit(u.default.playGainDiamondsAnimation,e)),yield h.default.delay(1)})}};return n([m(cc.Button)],t.prototype,"btnVideo",void 0),n([m(cc.Node)],t.prototype,"diamondNode",void 0),n([m(cc.Node)],t.prototype,"coinNode",void 0),t=n([g],t)})();o.default=y,cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/data/GameNumberUtils":"GameNumberUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../../BattleEvent":"BattleEvent","../../Configs":"Configs","../AdsController":"AdsController","../IconLabel":"IconLabel","./DialogManager":"DialogManager","./dialog":"dialog"}],LotteryButton:[function(t,e,o){"use strict";cc._RF.push(e,"6e45egyPYFIS6BJmVyAEqpk","LotteryButton");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("../dialog/DialogManager"),s=t("../../../common/SoundsController"),{ccclass:a,property:l}=cc._decorator;let c=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.wheel=null}onLoad(){let t=[];t.push(cc.rotateBy(.5,-2160)),t.push(cc.rotateBy(.3,-1800)),t.push(cc.rotateBy(.2,-1440)),t.push(cc.delayTime(2)),this.wheel.runAction(cc.repeatForever(cc.sequence(t))),this.node.on("click",this.onClick,this)}onClick(){s.default.getInstance().playSound(s.SoundId.click),i.default.getInstance().showDialog(i.DialogType.lottery)}};return n([l(cc.Node)],t.prototype,"wheel",void 0),t=n([a],t)})();o.default=c,cc._RF.pop()},{"../../../common/SoundsController":"SoundsController","../dialog/DialogManager":"DialogManager"}],MainScene:[function(t,e,o){"use strict";cc._RF.push(e,"41ac4e+ce5PC7yeDVzkHpWU","MainScene");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./common/data/UserDataManager"),a=t("./common/i18n/i18n"),l=t("./battle/Configs"),c=t("./battle/BattleEvent"),r=t("./battle/UI/dialog/DialogManager"),d=t("./common/SoundsController"),u=t("./common/platform/PlatformUtils"),h=t("./battle/guide/GuideController"),{ccclass:p,property:f}=cc._decorator;let g=(()=>{let t=class extends cc.Component{start(){this.init()}init(){return i(this,void 0,void 0,function*(){u.default.getInstance().keepScreenOn(!0),a.i18n.init(a.Lang.chs),s.default.getInstance().init("alpha1"),d.default.getInstance().soundOn(s.default.getInstance().soundOn),yield l.default.init(),cc.systemEvent.emit(c.default.userDataLoaded),yield this.prepareGame(),cc.systemEvent.emit(c.default.gameReady)})}prepareGame(){return i(this,void 0,void 0,function*(){s.default.getInstance().isNewUser?yield h.default.getInstance().show():(yield this.showSignDialog(),yield this.showOfflineCoinsDialog())})}showSignDialog(){return i(this,void 0,void 0,function*(){if(!s.default.getInstance().isSignToday)return new Promise(t=>{r.default.getInstance().showDialog(r.DialogType.sign,null,t)})})}showOfflineCoinsDialog(){return i(this,void 0,void 0,function*(){let t=s.default.getInstance().getDrawOfflineCoinsInterval();if(!(t<30))return new Promise(e=>{try{let o=s.default.getInstance().mainStage,n=s.default.getInstance().subStage,i=l.default.stageConfigs[o][n-1].offlineCoins*t;console.log(`offline interval:${t}, coins: ${i}`),r.default.getInstance().showDialog(r.DialogType.offlineCoins,{interval:t,coins:i},e)}catch(t){console.log(t)}})})}};return t=n([p],t)})();o.default=g,cc._RF.pop()},{"./battle/BattleEvent":"BattleEvent","./battle/Configs":"Configs","./battle/UI/dialog/DialogManager":"DialogManager","./battle/guide/GuideController":"GuideController","./common/SoundsController":"SoundsController","./common/data/UserDataManager":"UserDataManager","./common/i18n/i18n":"i18n","./common/platform/PlatformUtils":"PlatformUtils"}],NewLevelTower:[function(t,e,o){"use strict";cc._RF.push(e,"041dfkCRfhP7qZdy0OyLFw9","NewLevelTower");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),a=t("../../../common/i18n/i18n"),l=t("../../../common/GameUtils"),c=t("../../../common/data/UserDataManager"),r=t("../AdsController"),d=t("./DialogManager"),u=t("../../Configs"),h=t("../IconLabel"),p=t("../../BattleEvent"),{ccclass:f,property:g}=cc._decorator;let m=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.towerIcon=null,this.btnGot=null,this.btnVideo=null,this.lbAmount=null,this.lbDoubleAmount=null,this.spTitle=null,this.amount=0}onLoad(){super.onLoad(),this.btnGot.node.on("click",this.onGot,this),this.btnVideo.node.on("click",this.onVideoGot,this)}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){this.initData(t),e.show.call(this,t)})}initData(t){this.amount=u.default.towerConfigs[t].unlockBonus,this.lbAmount.string=a.i18n.getNumberString(this.amount),this.lbDoubleAmount.string=a.i18n.getNumberString(2*this.amount),l.default.setTowerDisplay(this.towerIcon.node,t)}onGot(){return i(this,void 0,void 0,function*(){this.playClickSound(),l.default.showGotTokenEffect(c.TokenType.coin,this.amount),yield this.hide(),c.default.getInstance().isNewUser?cc.systemEvent.emit(p.default.gotTowerUnlockReward):this.showDoubleDialog(this.amount)})}onVideoGot(){return i(this,void 0,void 0,function*(){c.default.getInstance().isNewUser||(this.playClickSound(),(yield r.default.getInstance().showVideo())&&(l.default.showGotTokenEffect(c.TokenType.coin,2*this.amount),yield this.hide(),this.showDoubleDialog(2*this.amount)))})}showDoubleDialog(t){d.default.getInstance().showDialog(d.DialogType.doubleApply,{type:c.TokenType.coin,amount:t})}};return n([g(sp.Skeleton)],t.prototype,"towerIcon",void 0),n([g(cc.Button)],t.prototype,"btnGot",void 0),n([g(cc.Button)],t.prototype,"btnVideo",void 0),n([g(cc.Label)],t.prototype,"lbAmount",void 0),n([g(h.default)],t.prototype,"lbDoubleAmount",void 0),n([g(cc.Sprite)],t.prototype,"spTitle",void 0),t=n([f],t)})();o.default=m,cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../../BattleEvent":"BattleEvent","../../Configs":"Configs","../AdsController":"AdsController","../IconLabel":"IconLabel","./DialogManager":"DialogManager","./dialog":"dialog"}],NumberAction:[function(t,e,o){"use strict";cc._RF.push(e,"908favF/0xHZ6FYK1UW0s2a","NumberAction"),Object.defineProperty(o,"__esModule",{value:!0});o.default=class extends cc.ActionInterval{constructor(t,e,o,n){super(),this.name="NumberAction",this.begin=e,this.end=o,this.callback=n,this.initWithDuration(t,e,o,n)}initWithDuration(t,e,o,n){return!!super.initWithDuration(t,this)&&(this.begin=parseFloat(e),this.end=parseFloat(o),this.callback=n,!0)}startWithTarget(t){super.startWithTarget(this,t),this.target=t}update(t){if(this.target){let e=this.begin+(this.end-this.begin)*t;this.callback&&this.callback(e)}}},cc._RF.pop()},{}],OfflineCoins:[function(t,e,o){"use strict";cc._RF.push(e,"7f787ae+DJMcrTyOIEy4iRu","OfflineCoins");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),a=t("../../../common/i18n/i18n"),l=t("../AdsController"),c=t("../../../common/GameUtils"),r=t("../../../common/data/UserDataManager"),d=t("./DialogManager"),u=t("../IconLabel"),{ccclass:h,property:p}=cc._decorator;let f=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.btnVideo=null,this.lbCoins=null,this.lbDoubleCoins=null,this.lbTips1=null,this.lbTips2=null,this.spTitle=null,this.coins=0}onLoad(){super.onLoad(),this.lbTips1=a.i18n.get("offlineTitle"),this.btnVideo.node.on("click",this.onVideo,this)}hide(){return i(this,void 0,void 0,function*(){yield this.onGotCoins(this.coins)})}onGotCoins(t){const e=Object.create(null,{hide:{get:()=>super.hide}});return i(this,void 0,void 0,function*(){c.default.showGotTokenEffect(r.TokenType.coin,t),r.default.getInstance().updateDrawOfflineCoinsTime(),yield e.hide.call(this),d.default.getInstance().showDialog(d.DialogType.doubleApply,{type:r.TokenType.coin,amount:t})})}onVideo(){return i(this,void 0,void 0,function*(){this.playClickSound(),(yield l.default.getInstance().showVideo())&&this.onGotCoins(2*this.coins)})}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){let{interval:o,coins:n}=t;this.coins=n,this.lbTips2.string=a.i18n.getFormat("offlineTime",o),this.lbDoubleCoins.string=a.i18n.getNumberString(2*this.coins),this.lbCoins.string=a.i18n.getNumberString(this.coins),e.show.call(this,t)})}};return n([p(cc.Button)],t.prototype,"btnVideo",void 0),n([p(u.default)],t.prototype,"lbCoins",void 0),n([p(u.default)],t.prototype,"lbDoubleCoins",void 0),n([p(cc.Label)],t.prototype,"lbTips1",void 0),n([p(cc.Label)],t.prototype,"lbTips2",void 0),n([p(cc.Sprite)],t.prototype,"spTitle",void 0),t=n([h],t)})();o.default=f,cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../AdsController":"AdsController","../IconLabel":"IconLabel","./DialogManager":"DialogManager","./dialog":"dialog"}],PassMainStage:[function(t,e,o){"use strict";cc._RF.push(e,"e4c5dDcsBlFy6M/eo5BfcKv","PassMainStage");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),a=t("../../../common/i18n/i18n"),l=t("../AdsController"),c=t("../../../common/GameUtils"),r=t("../../../common/data/UserDataManager"),d=t("./DialogManager"),u=t("../IconLabel"),{ccclass:h,property:p}=cc._decorator;let f=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.btnVideo=null,this.lbCoins=null,this.lbDoubleCoins=null,this.lbCd=null,this.spTitle=null,this.coins=0,this.cdTime=0}onLoad(){super.onLoad(),this.btnVideo.node.on("click",this.onVideo,this),this.cdScheduler=this.countdown.bind(this)}hide(){return i(this,void 0,void 0,function*(){yield this.onGotCoins(this.coins)})}onGotCoins(t){const e=Object.create(null,{hide:{get:()=>super.hide}});return i(this,void 0,void 0,function*(){c.default.showGotTokenEffect(r.TokenType.coin,t),yield e.hide.call(this),d.default.getInstance().showDialog(d.DialogType.doubleApply,{type:r.TokenType.coin,amount:t})})}onEnable(){this.schedule(this.cdScheduler,1,cc.macro.REPEAT_FOREVER)}onDisable(){this.unschedule(this.cdScheduler)}onVideo(){return i(this,void 0,void 0,function*(){this.playClickSound(),(yield l.default.getInstance().showVideo())&&this.onGotCoins(2*this.coins)})}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){this.coins=t,this.cdTime=5,this.lbCd.string=this.cdTime.toString(),this.lbDoubleCoins.string=a.i18n.getNumberString(2*this.coins),this.lbCoins.string=a.i18n.getNumberString(this.coins),e.show.call(this,t)})}countdown(){if(--this.cdTime,this.cdTime<=0)return this.cdTime=0,void this.hide();this.lbCd.string=this.cdTime.toString()}};return n([p(cc.Button)],t.prototype,"btnVideo",void 0),n([p(u.default)],t.prototype,"lbCoins",void 0),n([p(u.default)],t.prototype,"lbDoubleCoins",void 0),n([p(cc.Label)],t.prototype,"lbCd",void 0),n([p(cc.Sprite)],t.prototype,"spTitle",void 0),t=n([h],t)})();o.default=f,cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../AdsController":"AdsController","../IconLabel":"IconLabel","./DialogManager":"DialogManager","./dialog":"dialog"}],PlatformUtils:[function(t,e,o){"use strict";cc._RF.push(e,"28186MGIP9O06jqkEwjVZUR","PlatformUtils"),Object.defineProperty(o,"__esModule",{value:!0});let n=(()=>{class t{static getInstance(){return this.ins}vibrate(t=.05){cc.sys.isNative&&jsb.Device.vibrate(t)}keepScreenOn(t){cc.sys.isNative&&jsb.Device.setKeepScreenOn(t)}}return t.ins=new t,t})();o.default=n,cc._RF.pop()},{}],QuickBuyButton:[function(t,e,o){"use strict";cc._RF.push(e,"ffd50ojZPlOuriSHJ8MvC3N","QuickBuyButton");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../BattleEvent"),a=t("../../../common/data/UserDataManager"),l=t("../../../common/data/GameNumberUtils"),c=t("../../../common/GameUtils"),r=t("../../../common/SoundsController"),d=t("../../../common/i18n/i18n"),{ccclass:u,property:h}=cc._decorator;let p=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.tower=null,this.lbCost=null,this.currentLevel=1}onLoad(){this.tower.node.active=!1,this.lbCost.string="",this.node.on("click",this.onBuy,this),cc.systemEvent.on(s.default.updateCoins,this.updateBuyInfo,this),cc.systemEvent.on(s.default.userDataLoaded,this.updateBuyInfo,this),cc.systemEvent.on(s.default.updateMaxTowerLevel,this.updateBuyInfo,this)}updateBuyInfo(){return i(this,void 0,void 0,function*(){let t=a.default.getInstance().maxCoinBuyTowerLevel,e=l.default.getInstance().getCoinsPrice(t);for(;t>1&&!(e<a.default.getInstance().coins);)t-=1,e=l.default.getInstance().getCoinsPrice(t);return this.currentLevel=t,this.lbCost.string=d.i18n.getNumberString(e),this.tower.node.active=!0,c.default.setTowerDisplay(this.tower.node,t)})}onBuy(){r.default.getInstance().playSound(r.SoundId.click),cc.systemEvent.emit(s.default.tryBuyTower,{level:this.currentLevel,type:a.TokenType.coin})}updateCost(){let t=a.default.getInstance().maxCoinBuyTowerLevel,e=l.default.getInstance().getCoinsPrice(t);this.lbCost.string=d.i18n.getNumberString(e)}};return n([h(sp.Skeleton)],t.prototype,"tower",void 0),n([h(cc.Label)],t.prototype,"lbCost",void 0),t=n([u],t)})();o.default=p,cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/SoundsController":"SoundsController","../../../common/data/GameNumberUtils":"GameNumberUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../../BattleEvent":"BattleEvent"}],SeedTower:[function(t,e,o){"use strict";cc._RF.push(e,"fb166Ng6hZNGo+PFN09hSbn","SeedTower");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("./Tower"),s=t("../BattleEvent"),{ccclass:a,property:l}=cc._decorator;let c=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.button=null}onLoad(){this.onHatch=this.onClick.bind(this)}onClick(){let t=this.getComponent(i.default).index;cc.systemEvent.emit(s.default.towerGrow,t),this.unschedule(this.onHatch)}onDisable(){this.button.interactable=!1,this.unschedule(this.onHatch),this.button.node.off(cc.Node.EventType.TOUCH_START,this.onClick,this)}onEnable(){this.button.node.on(cc.Node.EventType.TOUCH_START,this.onClick,this),this.hatchId=this.scheduleOnce(this.onHatch,10),this.button.interactable=!0}};return n([l(cc.Button)],t.prototype,"button",void 0),t=n([a],t)})();o.default=c,cc._RF.pop()},{"../BattleEvent":"BattleEvent","./Tower":"Tower"}],SellController:[function(t,e,o){"use strict";cc._RF.push(e,"6d41dnvcCpAIa6yZlbEtl09","SellController");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:s}=cc._decorator;let a=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.sellNode=null,this.actionButtonsNode=null}onLoad(){this.sellNode.opacity=0}isInSell(t){return this.sellNode.getBoundingBoxToWorld().intersects(t)}showSell(){this.sellNode.stopAllActions(),this.actionButtonsNode.stopAllActions();this.sellNode.runAction(cc.spawn(cc.moveTo(.3,0,this.sellNode.height),cc.fadeIn(.3))),this.actionButtonsNode.runAction(cc.spawn(cc.moveTo(.3,0,-this.actionButtonsNode.height),cc.fadeOut(.3)))}hideSell(){this.sellNode.stopAllActions(),this.actionButtonsNode.stopAllActions();this.sellNode.runAction(cc.spawn(cc.moveTo(.3,0,0),cc.fadeOut(.3))),this.actionButtonsNode.runAction(cc.spawn(cc.moveTo(.3,0,0),cc.fadeIn(.3)))}};return n([s(cc.Node)],t.prototype,"sellNode",void 0),n([s(cc.Node)],t.prototype,"actionButtonsNode",void 0),t=n([i],t)})();o.default=a,cc._RF.pop()},{}],ShopItem:[function(t,e,o){"use strict";cc._RF.push(e,"44c12aj9SFDPIlX2TKOnroy","ShopItem");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../Configs"),a=t("../../../common/AssetsManager"),l=t("../../../common/i18n/i18n"),c=t("../../../common/data/UserDataManager"),r=t("../../tower/Tower"),d=t("../../../lib/components/TableView/viewCell"),u=t("../../../common/data/GameNumberUtils"),h=t("../../BattleEvent"),p=t("../../../common/SoundsController"),f=t("../IconLabel"),g=new cc.Color(240,117,255),{ccclass:m,property:y}=cc._decorator;let v=(()=>{let t=class extends d.default{constructor(){super(...arguments),this.tokenIcon=null,this.lbSkill=null,this.lbPowerTitle=null,this.lbPower=null,this.lbSpeedTitle=null,this.lbSpeed=null,this.lbIndex=null,this.lbCost=null,this.towerIcon=null,this.btnNormal=null,this.btnDisable=null,this.unlock=!1,this.spCoin=null,this.spDiamond=null}onLoad(){this.btnNormal.on("click",this.onBuy,this)}onBuy(){p.default.getInstance().playSound(p.SoundId.click),cc.systemEvent.emit(h.default.tryBuyTower,{level:this.config.level,type:this.buyType}),this.scheduleOnce(this.updateButton.bind(this),.01)}static getSize(t,e){return 140}updateTowerDisplay(){return i(this,void 0,void 0,function*(){let t=this.config.level<=c.default.getInstance().maxTowerLevel;this.towerIcon.skeletonData=yield a.default.getInstance().getTowerSkeletonAssets(this.config.level),this.towerIcon.node.color=t?cc.Color.WHITE:cc.Color.BLACK,this.towerIcon.setAnimation(0,r.TowerActionType.idle,!0)})}updateButton(){let t=this.config;if(this.btnNormal.active=this.unlock,this.btnDisable.active=!this.btnNormal.active,this.unlock)if(c.default.getInstance().maxDiamondsBuyTowerLevel===t.level&&t.level>1){this.tokenIcon.spriteFrame=this.spDiamond;let e=u.default.getInstance().getDiamondsPrice(t.level);this.lbCost.string=l.i18n.getNumberString(e),this.lbCost.color=g,this.buyType=c.TokenType.diamond}else{this.tokenIcon.spriteFrame=this.spCoin;let e=u.default.getInstance().getCoinsPrice(t.level);this.lbCost.string=l.i18n.getNumberString(e),this.lbCost.color=cc.Color.WHITE,this.buyType=c.TokenType.coin}}setDesc(){let t=this.config;this.lbIndex.string=t.level.toString();let e=l.i18n.get("skillDescs")[t.skillType];this.lbSkill.string=l.i18n.getFormat("skillDesc",Math.floor(100*t.skillProbability),e),this.lbPower.string=l.i18n.getNumberString(t.power),this.lbSpeed.string=t.cd.toFixed(2)}init(t,e,o){return i(this,void 0,void 0,function*(){let e=t+1,o=s.default.towerConfigs[e];this.config=o;let n=Math.max(c.default.getInstance().maxTowerLevel-3,1);this.unlock=n>=o.level,this.updateTowerDisplay(),this.setDesc(),this.updateButton()})}uninit(){}reload(t){}};return n([y(cc.Sprite)],t.prototype,"tokenIcon",void 0),n([y(cc.Label)],t.prototype,"lbSkill",void 0),n([y(cc.Label)],t.prototype,"lbPowerTitle",void 0),n([y(cc.Label)],t.prototype,"lbPower",void 0),n([y(cc.Label)],t.prototype,"lbSpeedTitle",void 0),n([y(cc.Label)],t.prototype,"lbSpeed",void 0),n([y(cc.Label)],t.prototype,"lbIndex",void 0),n([y(f.default)],t.prototype,"lbCost",void 0),n([y(sp.Skeleton)],t.prototype,"towerIcon",void 0),n([y(cc.Node)],t.prototype,"btnNormal",void 0),n([y(cc.Node)],t.prototype,"btnDisable",void 0),n([y(cc.SpriteFrame)],t.prototype,"spCoin",void 0),n([y(cc.SpriteFrame)],t.prototype,"spDiamond",void 0),t=n([m],t)})();o.default=v,cc._RF.pop()},{"../../../common/AssetsManager":"AssetsManager","../../../common/SoundsController":"SoundsController","../../../common/data/GameNumberUtils":"GameNumberUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../../../lib/components/TableView/viewCell":"viewCell","../../BattleEvent":"BattleEvent","../../Configs":"Configs","../../tower/Tower":"Tower","../IconLabel":"IconLabel"}],SignItem:[function(t,e,o){"use strict";cc._RF.push(e,"c0888mYPdZJC492U+MnhC41","SignItem");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("../../../common/i18n/i18n"),s=t("../../../common/data/UserDataManager"),a=t("../../../common/data/GameNumberUtils"),{ccclass:l,property:c}=cc._decorator;let r=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.signedNode=null,this.lbDiamonds=null,this.lbTitle=null}onLoad(){}setup(t){this.lbTitle.string=i.i18n.getFormat("signItemTitle",t),this.signedNode.active=s.default.getInstance().getSignDays()>=t,this.lbDiamonds.string=a.default.getInstance().getDiamondsForSignDay(t).toString()}};return n([c(cc.Node)],t.prototype,"signedNode",void 0),n([c(cc.Label)],t.prototype,"lbDiamonds",void 0),n([c(cc.Label)],t.prototype,"lbTitle",void 0),t=n([l],t)})();o.default=r,cc._RF.pop()},{"../../../common/data/GameNumberUtils":"GameNumberUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n"}],SimpleNodePool:[function(t,e,o){"use strict";cc._RF.push(e,"3cea2L3FjVHnogQULQQHHhU","SimpleNodePool"),Object.defineProperty(o,"__esModule",{value:!0});o.default=class extends cc.NodePool{constructor(t){super(null),t instanceof cc.Prefab||t instanceof cc.Node?this.itemCreator=(()=>cc.instantiate(t)):this.itemCreator=t}get(...t){return this.size()>0?super.get(...t):this.itemCreator()}},cc._RF.pop()},{}],SoundsController:[function(t,e,o){"use strict";cc._RF.push(e,"58edcoHnJJBkYYZOKJsBoQw","SoundsController");var n=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.SoundId=void 0;const i=t("./AssetsManager");let s=(()=>{class t{constructor(){this.enabled=!0,this.musicName=""}static getInstance(){return this.ins||(this.ins=new t),this.ins}soundOn(t){this.enabled=t,this.enabled?this.playMusic(this.musicName):cc.audioEngine.stopAll()}play(t,e=!1,o=1){return n(this,void 0,void 0,function*(){if(!this.enabled)return;let n=yield i.default.getInstance().getSound(t);n?cc.audioEngine.play(n,e,o):console.log("load sound error:",t)})}playMusic(t){return n(this,void 0,void 0,function*(){this.musicName&&(this.musicName=t,this.enabled&&this.play(t,!0))})}playSound(t,e=!1){return n(this,void 0,void 0,function*(){this.play(t,e)})}}return t.ins=null,t})();o.default=s,o.SoundId={bloom:"bloom",click:"click",coins:"coins",diamonds:"diamonds",failed:"failed",addSeed:"addSeed",hit:"hit",lvUp:"lvUp",unlock:"unlock",critical:"critical",stun:"stun",slow:"slow",wheel:"wheel",victory1:"victory1",victory2:"victory2",enemyEnter:"enemyEnter"},cc._RF.pop()},{"./AssetsManager":"AssetsManager"}],SpeedUpButton:[function(t,e,o){"use strict";cc._RF.push(e,"03ebaxifZRDqr3cTOO0ULmP","SpeedUpButton");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("../../BattleEvent"),s=t("../dialog/DialogManager"),a=t("../../Configs"),l=t("../../../common/SoundsController"),{ccclass:c,property:r}=cc._decorator;let d=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.lbSpeedUpTime=null,this.speedUpTime=0}onLoad(){this.node.on("click",this.onSpeedUp,this),this.speedUpCounter=this.countdown.bind(this),this.lbSpeedUpTime.node.active=!1,cc.systemEvent.on(i.default.speedUp,t=>t&&this.startSpeedUp())}onSpeedUp(){l.default.getInstance().playSound(l.SoundId.click),s.default.getInstance().showDialog(s.DialogType.speedUp)}startSpeedUp(){this.lbSpeedUpTime.node.active=!0,this.speedUpTime<=0&&this.schedule(this.speedUpCounter,1,999),this.speedUpTime=a.default.speedUpDuration,this.updateCDLabel()}countdown(){--this.speedUpTime,this.updateCDLabel(),0===this.speedUpTime&&(this.lbSpeedUpTime.node.active=!1,this.unschedule(this.speedUpCounter),cc.systemEvent.emit(i.default.speedUp,!1))}updateCDLabel(){this.lbSpeedUpTime.string=this.speedUpTime.toString(),this.speedUpTime<10?this.lbSpeedUpTime.string="00:0"+this.speedUpTime:this.lbSpeedUpTime.string="00:"+this.speedUpTime}};return n([r(cc.Label)],t.prototype,"lbSpeedUpTime",void 0),t=n([c],t)})();o.default=d,cc._RF.pop()},{"../../../common/SoundsController":"SoundsController","../../BattleEvent":"BattleEvent","../../Configs":"Configs","../dialog/DialogManager":"DialogManager"}],StageInfo:[function(t,e,o){"use strict";cc._RF.push(e,"8a6aezmAsdN8bf5wbqSTNnL","StageInfo");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("../../BattleEvent"),{ccclass:s,property:a}=cc._decorator;let l=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.lbPreStage=null,this.lbCurrentStage=null,this.lbNextStage=null,this.lbSubStage=null,this.leftArrow=null}onLoad(){cc.systemEvent.on(i.default.stageStart,this.onStageInfoUpdate,this)}onStageInfoUpdate(t){this.node.active=!0,this.leftArrow.active=t.mainLevel>1,this.lbPreStage.string=(t.mainLevel-1).toString(),this.lbCurrentStage.string=t.mainLevel.toString(),this.lbNextStage.string=(t.mainLevel+1).toString(),this.lbSubStage.string=`${t.subLevel}/5`}};return n([a(cc.Label)],t.prototype,"lbPreStage",void 0),n([a(cc.Label)],t.prototype,"lbCurrentStage",void 0),n([a(cc.Label)],t.prototype,"lbNextStage",void 0),n([a(cc.Label)],t.prototype,"lbSubStage",void 0),n([a(cc.Node)],t.prototype,"leftArrow",void 0),t=n([s],t)})();o.default=l,cc._RF.pop()},{"../../BattleEvent":"BattleEvent"}],TokenUI:[function(t,e,o){"use strict";cc._RF.push(e,"ab04f0vq6hNHbcnDhKgp6N7","TokenUI");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../BattleEvent"),a=t("../../../common/i18n/i18n"),l=t("../../../common/data/UserDataManager"),c=t("../../effect/EffectFactory"),r=t("../../../common/SoundsController"),{ccclass:d,property:u}=cc._decorator;let h=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.lbCoins=null,this.lbDiamonds=null,this.effectFactory=null}onLoad(){cc.systemEvent.on(s.default.updateCoins,this.onCoinsUpdate,this),cc.systemEvent.on(s.default.updateDiamonds,this.onDiamondsUpdate,this),cc.systemEvent.on(s.default.userDataLoaded,this.init,this),cc.systemEvent.on(s.default.playGainCoinsAnimation,this.onplayGainCoinsAnimation,this),cc.systemEvent.on(s.default.playGainDiamondsAnimation,this.onplayGainDiamondsAnimation,this)}init(){console.log("BattleEvent.userDataLoaded"),this.lbDiamonds.string=a.i18n.getNumberString(l.default.getInstance().diamonds),this.lbCoins.string=a.i18n.getNumberString(l.default.getInstance().coins)}onCoinsUpdate(t){this.lbCoins.string=a.i18n.getNumberString(t),this.playScaleAction(this.lbCoins.node)}onDiamondsUpdate(t){this.lbDiamonds.string=a.i18n.getNumberString(t),this.playScaleAction(this.lbDiamonds.node)}playScaleAction(t){let e=[];t.stopAllActions(),e.push(cc.scaleTo(.13,1.3)),e.push(cc.scaleTo(.13,1)),t.runAction(cc.sequence(e))}onplayGainCoinsAnimation(t,e=null){return i(this,void 0,void 0,function*(){r.default.getInstance().playSound(r.SoundId.coins),e=this.node.convertToNodeSpaceAR(e||cc.visibleRect.center);let o=[];for(let t=0;t<6;t++){let t=this.effectFactory.getCoin();this.node.addChild(t);let n=this.playTokenAnimation(t,e,this.getCoinsPos(),()=>{this.effectFactory.putCoin(t)});o.push(n)}yield Promise.all(o),l.default.getInstance().addCoins(t)})}getDiamondsPos(){return this.ptDiamonds||(this.ptDiamonds=this.node.convertToNodeSpaceAR(this.lbDiamonds.node.convertToWorldSpaceAR(cc.v2()))),this.ptDiamonds}getCoinsPos(){return this.ptCoins||(this.ptCoins=this.node.convertToNodeSpaceAR(this.lbCoins.node.convertToWorldSpaceAR(cc.v2()))),this.ptCoins}onplayGainDiamondsAnimation(t,e=null){return i(this,void 0,void 0,function*(){r.default.getInstance().playSound(r.SoundId.diamonds),e=this.node.convertToNodeSpaceAR(e||cc.visibleRect.center);let o=[];for(let t=0;t<6;t++){let t=this.effectFactory.getDiamond();this.node.addChild(t);let n=this.playTokenAnimation(t,e,this.getDiamondsPos(),()=>{this.effectFactory.putDiamond(t)});o.push(n)}yield Promise.all(o),l.default.getInstance().addDiamonds(t)})}playTokenAnimation(t,e,o,n){return new Promise(i=>{t.setPosition(e);const s=o.sub(e),a=s.mag(),l=Math.min(.9,a/1e3)+.5*Math.random(),c=cc.v2((e.x+o.x)/2,(e.y+o.y)/2),r=s.rotate(-Math.PI/2).normalizeSelf(),d=(o.x>e.x?1:-1)*(.5*Math.random()+.2)*a;t.scale=.5,t.angle=-40,t.runAction(cc.spawn(cc.sequence(cc.scaleTo(.5*l,1),cc.scaleTo(.5*l,.5)).easing(cc.easeSineOut()),cc.sequence(cc.bezierTo(l,[e,c.add(r.mul(d)),o]).easing(cc.easeSineOut()),cc.callFunc(()=>{n(),i()}))))})}};return n([u(cc.Label)],t.prototype,"lbCoins",void 0),n([u(cc.Label)],t.prototype,"lbDiamonds",void 0),n([u(c.default)],t.prototype,"effectFactory",void 0),t=n([d],t)})();o.default=h,cc._RF.pop()},{"../../../common/SoundsController":"SoundsController","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../../BattleEvent":"BattleEvent","../../effect/EffectFactory":"EffectFactory"}],TowerBase:[function(t,e,o){"use strict";cc._RF.push(e,"0c45f2QIJFPXrFq4WrTs90m","TowerBase");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../common/GameUtils"),a=t("./TowerFactory"),l=t("../Configs"),c=t("../BattleEvent"),r=t("../../common/data/UserDataManager"),d=t("../../common/i18n/i18n"),u=t("../effect/EffectFactory"),h=t("../../common/SoundsController"),p=t("../UI/dialog/DialogManager"),{ccclass:f,property:g}=cc._decorator;let m=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.lock=null,this.lbCoins=null,this.sameLevelTips=null,this.locked=!0,this.unlockCost=0,this.index=0}get hasTower(){return!!this.tower}get towerLevel(){return this.tower?this.tower.level:-1}get usable(){return!this.locked&&!this.hasTower}onLoad(){this.showLock(!1)}showLock(t,e=0){this.locked=t,this.unlockCost=e,this.lock.active=this.locked,this.locked&&(this.lbCoins.string=d.i18n.getNumberString(e),this.node.on("click",this.onUnlock,this))}onUnlock(){this.locked&&(r.default.getInstance().coins>=this.unlockCost?(h.default.getInstance().playSound(h.SoundId.unlock),this.locked=!1,this.lock.active=!1,r.default.getInstance().addUnlockBaseIndex(this.index,this.unlockCost)):s.default.alert(d.i18n.get("lackedCoins")))}addTower(t){let e=l.default.towerConfigs[t],o=a.default.getInstance().get(e);this.tower=o,o.node.x=0,o.node.y=0,this.node.addChild(o.node)}setTower(t){return i(this,void 0,void 0,function*(){if(this.tower){let e=l.default.towerConfigs[t];yield this.tower.init(e)}else this.addTower(t);0==t?this.tower.enableSeed():t>0&&this.tower.enableAttack(),cc.systemEvent.emit(c.default.towerUpdate,{index:this.index,level:t}),this.tower.index=this.index,r.default.getInstance().updateTowerData(this.index,t)})}growTower(){return i(this,void 0,void 0,function*(){yield this.playLvUpEffect(),h.default.getInstance().playSound(h.SoundId.bloom),this.setTower(r.default.getInstance().seedTowerLevel)})}removeTower(){this.tower.dispose(),this.tower=null,cc.systemEvent.emit(c.default.towerUpdate,{index:this.index,level:-1}),r.default.getInstance().updateTowerData(this.index,-1)}showSameLevelTips(t){if(this.sameLevelTips.active=t,t){let t=[],e=1;t.push(cc.scaleTo(e,1.1)),t.push(cc.scaleTo(e,1)),this.sameLevelTips.runAction(cc.repeatForever(cc.sequence(t)))}else this.sameLevelTips.stopAllActions()}levelUpTower(){return i(this,void 0,void 0,function*(){console.log("level up"),yield this.playLevelUpAnimation(),h.default.getInstance().playSound(h.SoundId.lvUp),this.checkUnloadNewTower(this.towerLevel+1),this.setTower(this.towerLevel+1)})}checkUnloadNewTower(t){t>r.default.getInstance().maxTowerLevel&&(r.default.getInstance().updateMaxTowerLevel(t),cc.systemEvent.emit(c.default.updateMaxTowerLevel),p.default.getInstance().showDialog(p.DialogType.newTowerLevel,t))}playLevelUpAnimation(){return i(this,void 0,void 0,function*(){this.tower.node.active=!1;let t=a.default.getInstance().get(this.tower.config);t.node.scaleX=-1,this.node.addChild(t.node),t.node.setPosition(0,0);let e=[];e.push(cc.moveTo(.15,cc.v2(-50,0))),e.push(cc.moveTo(.15,cc.v2(0,0))),t.node.runAction(cc.sequence(e));let o=a.default.getInstance().get(this.tower.config);this.node.addChild(o.node),o.node.setPosition(0,0),(e=[]).push(cc.moveTo(.15,cc.v2(50,0))),e.push(cc.moveTo(.15,cc.v2(0,0))),o.node.runAction(cc.sequence(e)),yield s.default.delay(.3),t.node.stopAllActions(),o.node.stopAllActions(),t.node.scaleX=1,a.default.getInstance().put(t),a.default.getInstance().put(o),yield this.playLvUpEffect()})}playLvUpEffect(){return i(this,void 0,void 0,function*(){let t=u.default.getInstance().getLvUp();t.scale=1.5,this.node.addChild(t),s.default.playOnceAnimation(t.getComponent(cc.Animation)).then(()=>{u.default.getInstance().putLvUp(t)}),yield s.default.delay(.05)})}addSeedTower(){return i(this,void 0,void 0,function*(){yield this.setTower(0),h.default.getInstance().playSound(h.SoundId.addSeed),this.tower.node.y=200,this.tower.node.opacity=0,this.tower.node.runAction(cc.spawn(cc.moveTo(.3,0,0).easing(cc.easeSineIn()),cc.fadeIn(.3)))})}sell(){this.removeTower()}};return n([g(cc.Node)],t.prototype,"lock",void 0),n([g(cc.Label)],t.prototype,"lbCoins",void 0),n([g(cc.Node)],t.prototype,"sameLevelTips",void 0),t=n([f],t)})();o.default=m,cc._RF.pop()},{"../../common/GameUtils":"GameUtils","../../common/SoundsController":"SoundsController","../../common/data/UserDataManager":"UserDataManager","../../common/i18n/i18n":"i18n","../BattleEvent":"BattleEvent","../Configs":"Configs","../UI/dialog/DialogManager":"DialogManager","../effect/EffectFactory":"EffectFactory","./TowerFactory":"TowerFactory"}],TowerFactory:[function(t,e,o){"use strict";cc._RF.push(e,"8bfdcb7AJdJDbO7+7HxBHhn","TowerFactory"),Object.defineProperty(o,"__esModule",{value:!0});const n=t("./Tower");class i{constructor(){this.itemPrefab=null}static getInstance(){return void 0===this.ins&&(this.ins=new i),this.ins}init(t){this.itemPrefab=t,this.pool=new cc.NodePool}get(t){let e,o=(e=this.pool.size()>0?this.pool.get():cc.instantiate(this.itemPrefab)).getComponent(n.default);return o.init(t),o}put(t){t.node.removeFromParent(!1),this.pool.put(t.node)}}o.default=i,cc._RF.pop()},{"./Tower":"Tower"}],Tower:[function(t,e,o){"use strict";cc._RF.push(e,"9917ePRKk1JRKb9OIo/9KAW","Tower");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.TowerScale=o.TowerActionType=void 0;const s=t("../../common/AssetsManager"),a=t("./TowerFactory"),l=t("./Attackable"),c=t("./SeedTower");o.TowerActionType={idle:"idle",attack:"attack"},o.TowerScale={attackable:.35,seed:.25,normal:.35};const{ccclass:r,property:d}=cc._decorator;let u=(()=>{let t=class extends cc.Component{constructor(){super(...arguments),this.display=null,this.lbLevel=null,this.attackable=null,this.seedTower=null,this.index=-1}onLoad(){this.attackable=this.getComponent(l.default),this.attackable.init(this.display),this.seedTower=this.getComponent(c.default),this.attackable.enabled=!1,this.seedTower.enabled=!1}get level(){return this.config?this.config.level:0}init(t){return i(this,void 0,void 0,function*(){this.node.active=!0,this.config=t,this.node.opacity=255;let e=this.display;e.node.scale=o.TowerScale.normal,e.node.scaleX=-o.TowerScale.normal,t?(this.lbLevel.node.active=!0,this.lbLevel.string=`lv.${t.level}`,e.skeletonData=yield s.default.getInstance().getTowerSkeletonAssets(t.level),e.setAnimation(0,o.TowerActionType.idle,!0)):(this.lbLevel.node.active=!1,e.skeletonData=yield s.default.getInstance().getSeedTowerSkeletonAssets(),e.setAnimation(0,o.TowerActionType.idle,!0)),this.display.paused=!1})}dispose(){this.attackable.enabled=!1,this.seedTower.enabled=!1,a.default.getInstance().put(this)}enableAttack(){this.attackable.enabled=!0,this.seedTower.enabled=!1,this.display.node.scale=o.TowerScale.attackable,this.display.node.scaleX=-o.TowerScale.attackable,this.seedTower.button.interactable=!1,this.attackable.updateTowerConfig(this.config)}enableSeed(){this.attackable.enabled=!1,this.seedTower.enabled=!0,this.display.node.scale=o.TowerScale.seed,this.seedTower.button.interactable=!0}setTranslucent(t){this.node.opacity=t?128:255}setVisible(t){this.node.opacity=t?255:1}};return n([d(sp.Skeleton)],t.prototype,"display",void 0),n([d(cc.Label)],t.prototype,"lbLevel",void 0),t=n([r],t)})();o.default=u,cc._RF.pop()},{"../../common/AssetsManager":"AssetsManager","./Attackable":"Attackable","./SeedTower":"SeedTower","./TowerFactory":"TowerFactory"}],UserDataManager:[function(t,e,o){"use strict";cc._RF.push(e,"d4258C+l0VFsK2RwCXrJ3mB","UserDataManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.TokenType=void 0;const n=t("../../battle/BattleEvent"),i=t("../GameUtils"),s=t("../../battle/Configs");(function(t){t[t.coin=0]="coin",t[t.diamond=1]="diamond"})(o.TokenType||(o.TokenType={}));let a=(()=>{class t{constructor(){this.key="user_data",this.isNewUser=!1,this.account="user",this.coins=0,this.diamonds=0,this.mainStage=1,this.subStage=1,this.maxTowerLevel=1,this.coinBuyTimes=[],this.diamondBuyTimes=[],this.soundOn=!0,this.vibrateOn=!1,this.drawVideoAdCoinTime=0,this.drawVideoAdCoinCount=0,this.drawVideoAdDiamondTime=0,this.drawVideoAdDiamondCount=0,this.signTime=0,this.drawOfflineCoinsTime=0,this.signDays=0,this.freeGotTicketTime=0,this.lastGotTicketTime=0,this.gotTicketsToday=0,this.tickets=0,this.lastGotBalloonRewardTime=0,this.balloonRewardCount=0}static getInstance(){return this.ins}init(t){this.account=t,this.key=`user_data_${t}`,console.log(this.key),this.fetch(),this.initSignData(),this.initFreeGotTicketData(),this.initVideoGotTokenData(),this.initBalloonData()}switchSoundOn(t){this.soundOn=t,this.save()}switchVibrateOn(t){this.vibrateOn=t,this.save()}clear(){console.log("clear user data:",this.key),cc.sys.localStorage.setItem(this.key,null),console.log(cc.sys.localStorage.getItem(this.key))}updateTowerData(t,e){this.towers[t]=e,this.save()}get seedTowerLevel(){return Math.max(1,this.maxTowerLevel-8)}addCoins(t){this.coins+=t,cc.systemEvent.emit(n.default.updateCoins,this.coins),this.save()}addDiamonds(t){this.diamonds+=t,cc.systemEvent.emit(n.default.updateDiamonds,this.diamonds),this.save()}addUnlockBaseIndex(t,e){this.unlockTowerBaseIndexes.includes(t)||(this.unlockTowerBaseIndexes.push(t),this.addCoins(-e))}fetch(){let t=cc.sys.localStorage.getItem(this.key);console.log(this.key,t);try{let e=JSON.parse(t);this.coins=e.coins||0,this.diamonds=e.diamonds||0,this.unlockTowerBaseIndexes=e.unlockTowerBaseIndexes||this.getDefaultUnlock(),this.towers=e.towers||new Array(12).fill(-1),this.mainStage=e.mainStage||1,this.subStage=e.subStage||1,this.coinBuyTimes=e.coinBuyTimes||[],this.diamondBuyTimes=e.diamondBuyTimes||[],this.maxTowerLevel=e.maxTowerLevel||1,this.signDays=e.signDays||0,this.drawVideoAdCoinTime=e.drawVideoAdCoinTime||0,this.drawVideoAdCoinCount=e.drawVideoAdCoinCount||0,this.drawVideoAdDiamondTime=e.drawVideoAdDiamondTime||0,this.drawVideoAdDiamondCount=e.drawVideoAdDiamondCount||0,this.signTime=e.signTime||0,this.drawOfflineCoinsTime=e.drawOfflineCoinsTime||Date.now(),this.freeGotTicketTime=e.freeGotTicketTime||0,this.lastGotTicketTime=e.lastGotTicketTime||0,this.gotTicketsToday=e.freeGotCountToday||0,this.tickets=e.tickets||0,this.lastGotBalloonRewardTime=e.lastGotBalloonRewardTime||0,this.balloonRewardCount=e.balloonRewardCount||0,this.soundOn=e.soundOn,!1!==this.soundOn&&(this.soundOn=!0),this.vibrateOn=e.vibrateOn,!1!==this.vibrateOn&&(this.vibrateOn=!0)}catch(t){this.assignDefaultValue()}}assignDefaultValue(){this.isNewUser=!0,this.coins=500,this.diamonds=0,this.unlockTowerBaseIndexes=this.getDefaultUnlock(),this.towers=new Array(12).fill(-1),this.coinBuyTimes=[],this.diamondBuyTimes=[],this.coinBuyTimes=[],this.diamondBuyTimes=[],this.maxTowerLevel=1,this.signDays=0,this.freeGotTicketTime=Date.now(),this.lastGotTicketTime=0,this.gotTicketsToday=0,this.tickets=0,this.save()}get maxCoinBuyTowerLevel(){return Math.max(1,this.maxTowerLevel-4)}get maxDiamondsBuyTowerLevel(){return Math.max(1,this.maxTowerLevel-3)}updateMaxTowerLevel(t){console.log("updateMaxTowerLevel:",t),t<=this.maxTowerLevel||(this.maxTowerLevel=t,this.save())}getDefaultUnlock(){return[0,1,2,3,4]}save(){let t={coins:this.coins,diamonds:this.diamonds,unlockTowerBaseIndexes:this.unlockTowerBaseIndexes,towers:this.towers,coinBuyTimes:this.coinBuyTimes,diamondBuyTimes:this.diamondBuyTimes,maxTowerLevel:this.maxTowerLevel,mainStage:this.mainStage,subStage:this.subStage,signDays:this.signDays,drawVideoAdCoinTime:this.drawVideoAdCoinTime,drawVideoAdCoinCount:this.drawVideoAdCoinCount,drawVideoAdDiamondTime:this.drawVideoAdDiamondTime,drawVideoAdDiamondCount:this.drawVideoAdDiamondCount,signTime:this.signTime,drawOfflineCoinsTime:this.drawOfflineCoinsTime,freeGotTicketTime:this.freeGotTicketTime,lastGotTicketTime:this.lastGotTicketTime,freeGotCountToday:this.gotTicketsToday,tickets:this.tickets,lastGotBalloonRewardTime:this.lastGotBalloonRewardTime,balloonRewardCount:this.balloonRewardCount,soundOn:this.soundOn,vibrateOn:this.vibrateOn};cc.sys.localStorage.setItem(this.key,JSON.stringify(t))}getCoinsBuyTimes(t){return this.coinBuyTimes[t]||0}addCoinsBuyTimes(t){let e=this.coinBuyTimes[t]||0;this.coinBuyTimes[t]=++e,this.save()}getDiamondsBuyTimes(t){return this.diamondBuyTimes[t]||0}addDiamondsBuyTimes(t){let e=this.diamondBuyTimes[t]||0;this.diamondBuyTimes[t]=++e,this.save()}updateStageInfo(t,e){this.mainStage=t,this.subStage=e,this.save()}enterNextStage(){let t=s.default.stageConfigs[this.mainStage];this.subStage===t.length?(this.mainStage+=1,this.subStage=1):this.subStage+=1,this.save()}restartMainState(){this.subStage=1,this.save()}isSameDay(t){let e=new Date,o=new Date(t);return e.setHours(0,0,0,0)===o.setHours(0,0,0,0)}initVideoGotTokenData(){this.isSameDay(this.drawVideoAdCoinTime)||(this.drawVideoAdCoinCount=0),this.isSameDay(this.drawVideoAdDiamondTime)||(this.drawVideoAdDiamondCount=0)}getDrawVideoAdCoinCount(){return this.drawVideoAdCoinCount}updateGetVideoAdCoinTime(){this.drawVideoAdCoinTime=Date.now(),this.drawVideoAdCoinCount=this.getDrawVideoAdCoinCount()+1,this.getDrawVideoAdCoinCount()&&console.log("drawVideoAdCoinCount",this.drawVideoAdCoinCount),this.save()}getDrawVideoAdDiamondCount(){return this.drawVideoAdDiamondCount}getDrawOfflineCoinsInterval(){if(!this.drawOfflineCoinsTime)return this.drawOfflineCoinsTime=Date.now(),0;let t=i.default.transferMs2Minute(Date.now()-this.drawOfflineCoinsTime);return t<1?0:t}updateDrawOfflineCoinsTime(){this.drawOfflineCoinsTime=Date.now()}updateGetVideoAdDiamondTime(){this.drawVideoAdDiamondTime=Date.now(),this.drawVideoAdDiamondCount=this.getDrawVideoAdDiamondCount()+1,this.getDrawVideoAdCoinCount()&&console.log("drawVideoAdCoinCount",this.drawVideoAdDiamondCount),this.save()}initSignData(){this.getSignInterval()>1&&(this.signDays=0),this.isSignToday||7!==this.signDays||(this.signDays=0)}get isSignToday(){return this.isSameDay(this.signTime)}getSignInterval(){let t=(new Date).setHours(0,0,0,0);return i.default.transferMs2Days(t-this.signTime)}canGetMoreTicket(){return this.gotTicketsToday<s.default.maxTicketGotPerDay&&this.tickets<s.default.totalTicketCountLimit}useTicket(){this.canGetMoreTicket()||(this.freeGotTicketTime=Date.now()),--this.tickets,this.save()}getSignDays(){return this.signDays}sign(){this.isSignToday||(this.signDays+=1,this.signTime=(new Date).setHours(0,0,0,0),this.save())}freeGotTicket(){this.freeGotTicketTime=Date.now(),this.gotTicket()}gotTicket(){this.tickets+=1,this.lastGotTicketTime=Date.now(),this.gotTicketsToday+=1,this.save()}getFreeGotTicketCD(){let t=s.default.ticketFreeGotInterval-Math.floor((Date.now()-this.freeGotTicketTime)/1e3);return t<0&&(t=0),t}initFreeGotTicketData(){this.isSameDay(this.lastGotTicketTime)||(this.gotTicketsToday=0)}initBalloonData(){this.isSameDay(this.lastGotBalloonRewardTime)||(this.balloonRewardCount=0)}hasBalloonRewardCount(){return console.log("balloon reward count:",this.balloonRewardCount),this.balloonRewardCount<s.LoadConfig.balloonTimes&&this.mainStage>=s.LoadConfig.balloonLevel}updateBalloonTimes(){++this.balloonRewardCount,this.lastGotBalloonRewardTime=Date.now()}}return t.ins=new t,t})();o.default=a,cc._RF.pop()},{"../../battle/BattleEvent":"BattleEvent","../../battle/Configs":"Configs","../GameUtils":"GameUtils"}],UserTimeData:[function(t,e,o){"use strict";cc._RF.push(e,"f34d9eEhUJBHoH8kJt52rfP","UserTimeData"),cc._RF.pop()},{}],balloon:[function(t,e,o){"use strict";cc._RF.push(e,"f639eRktV1GuaUNqC1+DCvv","balloon");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),a=t("../../../common/i18n/i18n"),l=t("../AdsController"),c=t("../../../common/data/UserDataManager"),r=t("./lottery"),d=t("../../../common/data/GameNumberUtils"),u=t("../../tower/BaseController"),h=t("../../../common/GameUtils"),p=t("./DialogManager"),{ccclass:f,property:g}=cc._decorator;let m=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.btnVideo=null,this.lbTips1=null,this.lbTips2=null,this.balloon=null}onLoad(){super.onLoad(),this.lbTips1.string=a.i18n.get("balloonTips1"),this.lbTips2.string=a.i18n.get("balloonTips2"),this.btnVideo.node.on("click",this.onGet,this),this.playBalloonAnimation()}show(t=null){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){this.btnVideo.interactable=!0,e.show.call(this,t)})}playBalloonAnimation(){let t=[];t.push(cc.moveTo(2,this.balloon.x,this.balloon.y+30)),t.push(cc.moveTo(2,this.balloon.x,this.balloon.y)),this.balloon.runAction(cc.repeatForever(cc.sequence(t)))}onGet(){return i(this,void 0,void 0,function*(){(yield l.default.getInstance().showVideo())&&(this.btnVideo.interactable=!1,yield this.getReward(),c.default.getInstance().updateBalloonTimes(),this.hide())})}createRewardData(){const t=[r.RewardType.coins,r.RewardType.diamonds,r.RewardType.coins,r.RewardType.diamonds,r.RewardType.tower],e=c.default.getInstance().balloonRewardCount,o=e%t.length,n=Math.floor(e/t.length)%2;let i=t[o];i!==r.RewardType.tower||u.default.getInstance().getUsableBase()||(i=t[n%2]);let s=0;switch(i){case r.RewardType.coins:{let t=c.default.getInstance().maxCoinBuyTowerLevel,e=d.default.getInstance().getOriginCoins(t),i=2*n+(o>=4?2:o>=2?1:0);s=Math.round(e*(1+.05*i));break}case r.RewardType.diamonds:{let t=c.default.getInstance().maxDiamondsBuyTowerLevel,e=d.default.getInstance().getOriginDiamonds(t);s=Math.max(1,Math.floor(e/2));let i=2*n+(o>=4?2:o>=2?1:0);s=Math.round(s*(1+.05*i));break}case r.RewardType.tower:{let t=c.default.getInstance().maxCoinBuyTowerLevel-2+n;s=Math.max(1,t);break}}return{type:i,value:s}}getReward(){return i(this,void 0,void 0,function*(){let{type:t,value:e}=this.createRewardData();switch(t){case r.RewardType.coins:h.default.alert(a.i18n.getFormat("rewardTips1",a.i18n.getNumberString(e))),yield h.default.showGotTokenEffect(c.TokenType.coin,e),this.showDoubleDialog(c.TokenType.coin,e);break;case r.RewardType.diamonds:h.default.alert(a.i18n.getFormat("rewardTips2",a.i18n.getNumberString(e))),yield h.default.showGotTokenEffect(c.TokenType.diamond,e),this.showDoubleDialog(c.TokenType.diamond,e);break;case r.RewardType.tower:h.default.alert(a.i18n.getFormat("rewardTips3",e)),u.default.getInstance().addTower(e),yield h.default.delay(1)}})}showDoubleDialog(t,e){p.default.getInstance().showDialog(p.DialogType.doubleApply,{type:t,amount:e,showBG:!0})}};return n([g(cc.Button)],t.prototype,"btnVideo",void 0),n([g(cc.Label)],t.prototype,"lbTips1",void 0),n([g(cc.Label)],t.prototype,"lbTips2",void 0),n([g(cc.Node)],t.prototype,"balloon",void 0),t=n([f],t)})();o.default=m,cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/data/GameNumberUtils":"GameNumberUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../../tower/BaseController":"BaseController","../AdsController":"AdsController","./DialogManager":"DialogManager","./dialog":"dialog","./lottery":"lottery"}],chs:[function(t,e,o){"use strict";cc._RF.push(e,"0a799Hh3P1Ac6uQamox6mJJ","chs"),Object.defineProperty(o,"__esModule",{value:!0}),o.chs=void 0,o.chs={loading:"\u6b63\u5728\u8f7d\u5165",adNoReadyTips:"\u89c6\u9891\u672a\u51c6\u5907\u597d",defaultString:"\u9519\u8bef\u6587\u5b57",lackedCoins:"\u91d1\u5e01\u4e0d\u8db3",lackedDiamonds:"\u94bb\u77f3\u4e0d\u8db3",lackedBase:"\u6ca1\u6709\u4f4d\u7f6e\u4e86\uff0c\u53ef\u4ee5\u5148\u51fa\u552e\u4e00\u4e9b\u54e6~",buySuccess:"\u8d2d\u4e70\u6210\u529f",skillDescs:["","\u8fdf\u7f13\u654c\u4eba","\u4f24\u5bb3\u7ffb\u500d","\u51fb\u6655\u654c\u4eba"],skillDesc:"\u6280\u80fd:{0}%\u51e0\u7387{1}",sellTowerTips:"\u51fa\u552e\u540e\uff0c\u60a8\u5c06\u5f97\u5230{0}\u91d1\u5e01\u3002\u786e\u8ba4\u8981\u51fa\u552e\u5417\uff1f",numberUnits:[16,12,8,4],numberUnitNames:["\u4eac","\u5146","\u4ebf","\u4e07"],lackedCoinTitleTips:"\u5f88\u5c34\u5c2c\uff0c\u91d1\u5e01\u4e0d\u8db3",lackedTips:"\u4eca\u65e5\u8fd8\u53ef\u9886\u53d6{0}/{1}\u6b21",lackedDiamondTitleTips:"\u5f88\u5c34\u5c2c\uff0c\u94bb\u77f3\u4e0d\u8db3",speedUpTips1:"\u6240\u6709\u690d\u7269\u7684\u653b\u51fb\u901f\u5ea6x2",speedUpTips2:"\u6301\u7eed30\u79d2",offlineTitle:"\u79bb\u7ebf\u6536\u76ca",offlineTime:"{0}\u5206\u949f\uff08\u6700\u957f\u65f6\u95f412\u5c0f\u65f6\uff09",signItemTitle:"\u7b2c{0}\u5929",lotteryGotCountTitle:"\u4eca\u65e5\u5df2\u83b7\u5f97",lotteryCDTips:"<color=#32BEFF>{0}</c> <color=#F3FF6E>\u540e\u81ea\u52a8\u83b7\u5f971\u5f20\uff0c\u6700\u591a\u83b7\u5f9710\u5f20</c>",lotteryGotTips:"\u62bd\u5956\u5238+1",rewardTips1:"\u83b7\u5f97\u4e86 {0} \u91d1\u5e01!",rewardTips2:"\u83b7\u5f97\u4e86 {0} \u94bb\u77f3!",rewardTips3:"\u83b7\u5f97\u4e86\u4e00\u9897 {0}\u7ea7\u690d\u7269!",maxGotTicketCountTips:"\u4eca\u65e5\u5df2\u9886\u53d6\u8d85\u8fc710\u6b21\uff0c\u8bf7\u660e\u5929\u518d\u6765\uff01",maxTotalTicketCountTips:"\u62bd\u5956\u5238\u6570\u91cf\u5df2\u7ecf\u8d85\u8fc710\u5f20\uff0c\u8bf7\u5148\u7528\u6389\u54e6\uff01",lackedTicket:"\u60a8\u7684\u62bd\u5956\u5238\u4e0d\u591f\u54e6!",balloonTips1:"\u6bcf\u65e5\u9886\u53d6\u6b21\u6570\u8d8a\u591a\u5956\u52b1\u8d8a\u9ad8",balloonTips2:"\u968f\u673a\u5956\u52b1\uff0c\u91d1\u5e01\u3001\u94bb\u77f3\u3001\u690d\u7269",confirmQuit:"\u662f\u5426\u9000\u51fa\u6e38\u620f\uff1f",guideTips1:"\u70b9\u51fb\u8fd9\u91cc\u4e70\u4e00\u9897\u690d\u7269",guideTips2:"\u518d\u70b9\u4e00\u6b21",guideTips3:"\u62d6\u52a8\u5230\u8fd9\u91cc\u5408\u6210\u4e00\u9897\u65b0\u690d\u7269",guideTips4:"\u70b9\u51fb\u8fd9\u91cc\u9886\u53d6\u60a8\u7684\u5956\u52b1",guideTips5:"\u79fb\u52a8\u690d\u7269\u6765\u62b5\u5fa1\u654c\u4eba",guideTips6:"\u79cd\u66f4\u591a\u7684\u690d\u7269\u5e76..",guideTips7:"\u62b5\u5fa1\u654c\u4eba\u6765\u88ad",guideTips8:"\u8d5a\u66f4\u591a\u7684\u94b1\u6765\u83b7\u53d6\u65b0\u7684\u690d\u7269\uff01"},cc._RF.pop()},{}],constants:[function(t,e,o){"use strict";cc._RF.push(e,"f8cb2k2tulKWq9+MIjzety3","constants"),Object.defineProperty(o,"__esModule",{value:!0}),o.Constants=void 0,o.Constants={designWidth:720,designHeight:1280},cc._RF.pop()},{}],dialog:[function(t,e,o){"use strict";cc._RF.push(e,"fbbe8UQddJALrHsib3UiKYi","dialog");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../../lib/components/AComponent"),a=t("../../../common/SoundsController"),{ccclass:l,property:c}=cc._decorator;let r=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.btnClose=null,this.panel=null}onLoad(){this.btnClose&&this.btnClose.node.once("click",this.onBtnClose,this)}onBtnClose(){this.playClickSound(),this.hide()}playClickSound(){a.default.getInstance().playSound(a.SoundId.click)}playShowAnimation(){return i(this,void 0,void 0,function*(){let t=this.panel||this.node;return t.stopAllActions(),t.scale=0,t.opacity=128,new Promise(e=>{let o=[];o.push(cc.spawn(cc.scaleTo(.3,1).easing(cc.easeElasticOut(.4)),cc.fadeTo(.3,255))),o.push(cc.callFunc(e)),t.runAction(cc.sequence(o))})})}playHideAnimation(){return i(this,void 0,void 0,function*(){let t=this.panel||this.node;return t.stopAllActions(),t.scale=1,new Promise(e=>{let o=[];o.push(cc.fadeTo(.1,0)),o.push(cc.callFunc(e)),t.runAction(cc.sequence(o))})})}show(t=null){return i(this,void 0,void 0,function*(){yield this.playShowAnimation()})}hide(){return i(this,void 0,void 0,function*(){yield this.playHideAnimation(),this.node.destroy(),this.closeCallback&&this.closeCallback(this.closeData)})}setCloseCB(t){this.closeCallback=t}};return n([c(cc.Button)],t.prototype,"btnClose",void 0),n([c(cc.Node)],t.prototype,"panel",void 0),t=n([l],t)})();o.default=r,cc._RF.pop()},{"../../../common/SoundsController":"SoundsController","../../../lib/components/AComponent":"AComponent"}],double:[function(t,e,o){"use strict";cc._RF.push(e,"41c898iGclAQos3Em6OF0tn","double");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),a=t("../../../common/data/UserDataManager"),l=t("../../../common/i18n/i18n"),c=t("../AdsController"),r=t("../../../common/GameUtils"),d=t("../IconLabel"),{ccclass:u,property:h}=cc._decorator;let p=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.sfCoin=null,this.sfDiamond=null,this.spIcon=null,this.lbAmount=null,this.btnOK=null,this.light=null,this.bg=null}onLoad(){super.onLoad(),this.btnOK.node.on("click",this.onOK,this),this.playLightAnimation()}playLightAnimation(){this.light.angle=0,this.light.runAction(cc.repeatForever(cc.sequence(cc.rotateBy(9,360),cc.callFunc(()=>this.light.angle=0))))}onOK(){return i(this,void 0,void 0,function*(){this.playClickSound(),(yield c.default.getInstance().showVideo())&&(this.btnOK.interactable=!1,r.default.showGotTokenEffect(this.type,this.amount),this.hide())})}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){this.initData(t),this.btnOK.interactable=!0,e.show.call(this,t)})}initData({type:t,amount:e,showBG:o}){this.type=t,this.amount=e,this.lbAmount.string=l.i18n.getNumberString(e),t==a.TokenType.coin?this.spIcon.spriteFrame=this.sfCoin:this.spIcon.spriteFrame=this.sfDiamond}};return n([h(cc.SpriteFrame)],t.prototype,"sfCoin",void 0),n([h(cc.SpriteFrame)],t.prototype,"sfDiamond",void 0),n([h(cc.Sprite)],t.prototype,"spIcon",void 0),n([h(d.default)],t.prototype,"lbAmount",void 0),n([h(cc.Button)],t.prototype,"btnOK",void 0),n([h(cc.Node)],t.prototype,"light",void 0),n([h(cc.Node)],t.prototype,"bg",void 0),t=n([u],t)})();o.default=p,cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../AdsController":"AdsController","../IconLabel":"IconLabel","./dialog":"dialog"}],en:[function(t,e,o){"use strict";cc._RF.push(e,"94fefCQOetGlIFE1bjdLlT2","en"),Object.defineProperty(o,"__esModule",{value:!0}),o.en=void 0,o.en={loading:"Loading...",adNoReadyTips:"Video not ready!",defaultString:"Wrong text",lackedCoins:"Gold coins shortage",lackedDiamonds:"Insufficient diamonds",lackedBase:"There is no place, you can sell some first.",buySuccess:"Successful purchase",skillDescs:["","Slow down the enemy","Damage doubled","Stun the enemy"],skillDesc:"Skill:{0}%Probability{1}",sellTowerTips:"After the sale, you will get {0} gold coins. Are you sure to sell?",numberUnits:[15,12,9,6,3],numberUnitNames:["P","T","G","M","K"],lackedCoinTitleTips:"Embarrassing, not enough gold coins",lackedTips:"You can get {0}/{1} times today",lackedDiamondTitleTips:"Embarrassing, not enough diamonds",speedUpTips1:"Attack speed of all plants x2",speedUpTips2:"Lasts 30 seconds",offlineTitle:"Offline revenue",offlineTime:"{0} minutes (maximum time 12 hours)",signItemTitle:"Day {0}",lotteryGotCountTitle:"Obtained today",lotteryCDTips:"<color=#F3FF6E>After</c> <color=#32BEFF>{0}</c> <color=#F3FF6E>automatically get 1 ticket, up to 10 tickets</c>",lotteryGotTips:"Lottery ticket +1",rewardTips1:"Earned {0} gold coins!",rewardTips2:"Get {0} diamonds!",rewardTips3:"Obtained a level {0} plant!",maxGotTicketCountTips:"You have received more than 10 times today, please come back tomorrow!",maxTotalTicketCountTips:"The number of lottery tickets has exceeded 10, please use it first!",lackedTicket:"Your lottery tickets are not enough!",balloonTips1:"The more times you receive, the higher the reward",balloonTips2:"Random rewards, gold coins, diamonds, plants",confirmQuit:"Sure to exit the game?",guideTips1:"Click here to buy a plant",guideTips2:"Click again",guideTips3:"Drag here to synthesize a new plant",guideTips4:"Click here to claim your reward",guideTips5:"Move plants to defend against enemies",guideTips6:"Plant more plants and defend against enemy attacks",guideTips7:"Earn more gold coins to acquire new plants!"},cc._RF.pop()},{}],i18nSprite:[function(t,e,o){"use strict";cc._RF.push(e,"4bca7RjSOZMSLmBEP09Hm3X","i18nSprite");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("./i18n/i18n"),{ccclass:s,property:a}=cc._decorator;let l=(()=>{let t=class extends cc.Component{onLoad(){let t=this.getComponent(cc.Sprite);i.i18n.localizeSprite(t)}};return t=n([s],t)})();o.default=l,cc._RF.pop()},{"./i18n/i18n":"i18n"}],i18n:[function(t,e,o){"use strict";cc._RF.push(e,"6830fgNu7RPmapm0HDdAJfY","i18n");var n=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.i18n=o.Lang=void 0;const i=t("./chs");o.Lang={chs:"chs",en:"en"},o.i18n={langObj:i.chs,lang:"chs",init(t){return n(this,void 0,void 0,function*(){this.lang=t,t==o.Lang.chs&&(this.langObj=i.chs)})},get(t){return this.langObj[t]||this.langObj.defaultString},transfer:(t,e,o)=>`${(t/e).toFixed(2)}${o}`,getFormat(...t){let e=t[0],o=this.get(e);if(!o)return console.log("i18n no exist key:",e),null;if(t.length<2)return o;for(let e=1;e<t.length;e++)o=o.replace(`{${e-1}}`,t[e]);return o},getNumberString(t){let e=o.i18n.get("numberUnits");for(let n=0;n<e.length;n++){let i=Math.pow(10,e[n]);if(t>i)return this.transfer(t,i,o.i18n.get("numberUnitNames")[n])}return t.toString()},localizeSprite(t){return n(this,void 0,void 0,function*(){if(this.lang==o.Lang.chs)return;let e=yield this.loadSpriteFrame(t.spriteFrame.name);e?t.spriteFrame=e:console.log("i18n sprite failed, name:"+t.spriteFrame.name)})},loadSpriteFrame(t){return n(this,void 0,void 0,function*(){return new Promise((e,o)=>{cc.resources.load(`i18n/${this.lang.toString()}/${t}`,cc.SpriteFrame,function(t,n){t?o(t):e(n)})})})}},cc._RF.pop()},{"./chs":"chs"}],lottery:[function(t,e,o){"use strict";cc._RF.push(e,"3a7f7ex/PNPG5WWkeVxl+FV","lottery");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.RewardType=void 0;const s=t("./dialog"),a=t("../../../common/i18n/i18n"),l=t("../AdsController"),c=t("../../../common/GameUtils"),r=t("../../../common/data/UserDataManager"),d=t("../../Configs"),u=t("../../../lib/NumberAction"),h=t("../../../common/data/GameNumberUtils"),p=t("../../tower/BaseController"),f=t("../../../common/SoundsController"),g=t("./DialogManager"),{ccclass:m,property:y}=cc._decorator;let v=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.lbGotCountTitle=null,this.lbTodayGotCount=null,this.lbCDTips=null,this.lbTotalTickets=null,this.sfCoins=null,this.sfDiamonds=null,this.btnVideo=null,this.btnDraw=null,this.spTitle=null,this.spCloseButton=null,this.spVideoButton=null,this.spDrawText=null,this.wheel=null,this.spCoins=null,this.spDiamonds=null,this.freeGetCD=0}onLoad(){super.onLoad(),this.initI18n(),this.btnVideo.node.on("click",this.onVideoGot,this),this.btnDraw.node.on("click",this.onDraw,this),this.cdScheduler=this.showCdTips.bind(this),this.wheel.angle=-22.5}onVideoGot(){return i(this,void 0,void 0,function*(){this.playClickSound(),r.default.getInstance().gotTicketsToday>=d.default.maxTicketGotPerDay?c.default.alert(a.i18n.get("maxGotTicketCountTips")):r.default.getInstance().tickets>=d.default.totalTicketCountLimit?c.default.alert(a.i18n.get("maxTotalTicketCountTips")):(yield l.default.getInstance().showVideo())&&(r.default.getInstance().gotTicket(),this.updateStatus(),c.default.alert(a.i18n.get("lotteryGotTips")))})}initI18n(){this.lbGotCountTitle=a.i18n.get("lotteryGotCountTitle")}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){this.initDrawItems(),this.updateStatus(),yield e.show.call(this,t),this.checkFreeGet()})}updateStatus(){this.updateTotalTickets(),r.default.getInstance().canGetMoreTicket()?(this.freeGetCD=r.default.getInstance().getFreeGotTicketCD(),this.schedule(this.cdScheduler,1,cc.macro.REPEAT_FOREVER)):(this.freeGetCD=0,this.unschedule(this.cdScheduler)),this.lbTodayGotCount.string="x"+r.default.getInstance().gotTicketsToday.toString(),this.updateCdTips()}updateCdTips(){let t=c.default.getLessHourTimeString(this.freeGetCD);this.lbCDTips.string=a.i18n.getFormat("lotteryCDTips",t)}checkFreeGet(){if(!r.default.getInstance().canGetMoreTicket())return;let t=r.default.getInstance().getFreeGotTicketCD();t<=0?(c.default.alert(a.i18n.get("lotteryGotTips")),r.default.getInstance().freeGotTicket(),this.freeGetCD=r.default.getInstance().getFreeGotTicketCD(),this.updateStatus()):this.freeGetCD=t}showCdTips(){this.freeGetCD<=0&&this.checkFreeGet(),this.freeGetCD<=0&&(this.freeGetCD=0),this.updateCdTips(),--this.freeGetCD}onDraw(){return i(this,void 0,void 0,function*(){if(this.playClickSound(),r.default.getInstance().tickets<=0)return void c.default.alert(a.i18n.get("lackedTicket"));f.default.getInstance().playSound(f.SoundId.wheel),r.default.getInstance().useTicket(),this.enabledButtons(!1);let t=this.getRewardIndex(),e=this.rewardList[t];e.type===b.tower&&p.default.getInstance().stopAutoGenerateSeed(),yield this.rotateToIndex(t),yield this.handleReward(e.type,e.value),this.updateStatus(),e.type===b.tower&&p.default.getInstance().startAutoGenerateSeed(),this.enabledButtons(!0)})}enabledButtons(t){this.btnDraw.interactable=t,this.btnVideo.interactable=t,this.btnClose.interactable=t}updateTotalTickets(){this.lbTotalTickets.string="x"+r.default.getInstance().tickets.toString()}getRewardIndex(){let t=2,e=Math.random(),o=0;for(let n=2;n>=0;--n)if(e<(o+=d.LoadConfig.lotteryChance[n])){t=n;break}let n=p.default.getInstance().getUsableBase()?2:1,i=c.default.randomInt(0,n);return i===b.tower&&2==t&&(t=1),this.rewardList.findIndex(e=>e.level===t&&e.type===i)}initDrawItems(){return i(this,void 0,void 0,function*(){let t=this.wheel.children;this.rewardList=this.createRewardList();for(let e=0;e<this.wheel.childrenCount;e++){let o=t[e],n=this.rewardList[e],i=this.getLabel("label",o),s=this.getSprite("icon",o);switch(n.type){case b.coins:s.spriteFrame=this.spCoins,i.string="+"+a.i18n.getNumberString(n.value);break;case b.diamonds:s.spriteFrame=this.spDiamonds,i.string="+"+a.i18n.getNumberString(n.value);break;case b.tower:s.node.removeComponent(cc.Sprite),s.addComponent(sp.Skeleton),console.log("reward tower level:",n.value),c.default.setTowerDisplay(s.node,n.value),s.node.scale=.4,s.node.y-=30,i.string="lv."+n.value}}})}rotateToIndex(t){return i(this,void 0,void 0,function*(){let e=this.wheel.angle=360-this.wheel.angle%360,o=35*c.default.random(-.5,.5),n=720+45*t+22.5+o,i=(n-e)/3*1+e;yield this.rotateToAngle(this.wheel,e,i,1,cc.easeQuinticActionIn()),yield this.rotateToAngle(this.wheel,i,i+1440,2),yield this.rotateToAngle(this.wheel,i,n,2,cc.easeQuinticActionOut())})}rotateToAngle(t,e,o,n,i){return new Promise(s=>{t.stopAllActions();let a=new u.default(n,e,o,e=>t.angle=360-e);t.runAction(cc.sequence(i?a.easing(i):a,cc.callFunc(s,this)))})}handleReward(t,e){return i(this,void 0,void 0,function*(){switch(t){case b.coins:c.default.alert(a.i18n.getFormat("rewardTips1",a.i18n.getNumberString(e))),c.default.showGotTokenEffect(r.TokenType.coin,e),this.showDoubleDialog(r.TokenType.coin,e);break;case b.diamonds:c.default.alert(a.i18n.getFormat("rewardTips2",a.i18n.getNumberString(e))),c.default.showGotTokenEffect(r.TokenType.diamond,e),this.showDoubleDialog(r.TokenType.diamond,e);break;case b.tower:c.default.alert(a.i18n.getFormat("rewardTips3",e)),p.default.getInstance().addTower(e)}})}showDoubleDialog(t,e){g.default.getInstance().showDialog(g.DialogType.doubleApply,{type:t,amount:e,showBG:!0})}createRewardList(){let t=[],e=r.default.getInstance().maxCoinBuyTowerLevel,o=h.default.getInstance().getCoinsForTimes(e,0);for(let e=0;e<3;++e){let n=Math.max(1,Math.round(o*(3-e)/3)),i={level:e,type:b.coins,value:n};t.push(i)}let n=r.default.getInstance().maxDiamondsBuyTowerLevel;o=h.default.getInstance().getOriginDiamonds(n);for(let e=0;e<3;++e){let n=Math.max(1,Math.floor(o*(3-e)/6)),i={level:e,type:b.diamonds,value:n};t.push(i)}let i=Math.max(1,r.default.getInstance().maxCoinBuyTowerLevel-2);for(let e=0;e<2;++e){let o=Math.max(1,i-e),n={level:e,type:b.tower,value:o};t.push(n)}return c.default.shuffleArray(t),t}};return n([y(cc.Label)],t.prototype,"lbGotCountTitle",void 0),n([y(cc.Label)],t.prototype,"lbTodayGotCount",void 0),n([y(cc.RichText)],t.prototype,"lbCDTips",void 0),n([y(cc.Label)],t.prototype,"lbTotalTickets",void 0),n([y(cc.SpriteFrame)],t.prototype,"sfCoins",void 0),n([y(cc.SpriteFrame)],t.prototype,"sfDiamonds",void 0),n([y(cc.Button)],t.prototype,"btnVideo",void 0),n([y(cc.Button)],t.prototype,"btnDraw",void 0),n([y(cc.Sprite)],t.prototype,"spTitle",void 0),n([y(cc.Sprite)],t.prototype,"spCloseButton",void 0),n([y(cc.Sprite)],t.prototype,"spVideoButton",void 0),n([y(cc.Sprite)],t.prototype,"spDrawText",void 0),n([y(cc.Node)],t.prototype,"wheel",void 0),n([y(cc.SpriteFrame)],t.prototype,"spCoins",void 0),n([y(cc.SpriteFrame)],t.prototype,"spDiamonds",void 0),t=n([m],t)})();var b;o.default=v,function(t){t[t.coins=0]="coins",t[t.diamonds=1]="diamonds",t[t.tower=2]="tower"}(b=o.RewardType||(o.RewardType={})),cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/SoundsController":"SoundsController","../../../common/data/GameNumberUtils":"GameNumberUtils","../../../common/data/UserDataManager":"UserDataManager","../../../common/i18n/i18n":"i18n","../../../lib/NumberAction":"NumberAction","../../Configs":"Configs","../../tower/BaseController":"BaseController","../AdsController":"AdsController","./DialogManager":"DialogManager","./dialog":"dialog"}],option:[function(t,e,o){"use strict";cc._RF.push(e,"090f408BDZOnY2W2ycCYzxd","option");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),{ccclass:a,property:l}=cc._decorator;let c=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.lbTips=null,this.btnCancel=null,this.btnOK=null}onLoad(){super.onLoad(),this.btnCancel.node.on("click",this.onCancel,this),this.btnOK.node.on("click",this.onOK,this)}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){this.lbTips.string=t,e.show.call(this,t)})}onCancel(){this.closeData=!1,this.hide()}onOK(){return i(this,void 0,void 0,function*(){this.hide(),this.closeData=!0})}};return n([l(cc.Label)],t.prototype,"lbTips",void 0),n([l(cc.Button)],t.prototype,"btnCancel",void 0),n([l(cc.Button)],t.prototype,"btnOK",void 0),t=n([a],t)})();o.default=c,cc._RF.pop()},{"./dialog":"dialog"}],settings:[function(t,e,o){"use strict";cc._RF.push(e,"5cd217bTP1LK57ia8wg60n0","settings");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const i=t("./dialog"),s=t("../../../common/data/UserDataManager"),a=t("../../../common/SoundsController"),{ccclass:l,property:c}=cc._decorator;let r=(()=>{let t=class extends i.default{constructor(){super(...arguments),this.btnSoundOn=null,this.btnVibrateOn=null,this.btnSoundOff=null,this.btnVibrateOff=null}onLoad(){super.onLoad(),this.btnSoundOn.node.on("click",this.onSoundOn,this),this.btnVibrateOn.node.on("click",this.onVibrateOn,this),this.btnSoundOff.node.on("click",this.onSoundOff,this),this.btnVibrateOff.node.on("click",this.onVibrateOff,this),this.updateSoundButton(),this.updateVibrateButton()}updateSoundButton(){this.btnSoundOff.node.active=s.default.getInstance().soundOn,this.btnSoundOn.node.active=!this.btnSoundOff.node.active}updateVibrateButton(){this.btnVibrateOff.node.active=s.default.getInstance().vibrateOn,this.btnVibrateOn.node.active=!this.btnVibrateOff.node.active}onSoundOn(){this.playClickSound(),s.default.getInstance().switchSoundOn(!0),a.default.getInstance().soundOn(!0),this.updateSoundButton()}onSoundOff(){this.playClickSound(),s.default.getInstance().switchSoundOn(!1),a.default.getInstance().soundOn(!1),this.updateSoundButton()}onVibrateOn(){this.playClickSound(),s.default.getInstance().switchVibrateOn(!0),this.updateVibrateButton()}onVibrateOff(){this.playClickSound(),s.default.getInstance().switchVibrateOn(!1),this.updateVibrateButton()}};return n([c(cc.Button)],t.prototype,"btnSoundOn",void 0),n([c(cc.Button)],t.prototype,"btnVibrateOn",void 0),n([c(cc.Button)],t.prototype,"btnSoundOff",void 0),n([c(cc.Button)],t.prototype,"btnVibrateOff",void 0),t=n([l],t)})();o.default=r,cc._RF.pop()},{"../../../common/SoundsController":"SoundsController","../../../common/data/UserDataManager":"UserDataManager","./dialog":"dialog"}],shop:[function(t,e,o){"use strict";cc._RF.push(e,"a4519Rep3VMkKxk7YpCGQq/","shop");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),a=t("../../Configs"),l=t("./ShopItem"),c=t("../../../lib/components/TableView/tableView"),r=t("../../../common/data/UserDataManager"),{ccclass:d,property:u}=cc._decorator;let h=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.tv=null}onLoad(){super.onLoad(),console.log("on load--------------------:"),this.tv.init(a.default.maxTowerLevel)}show(){const t=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){yield t.show.call(this,null);let e=l.default.getSize(0)*(r.default.getInstance().maxCoinBuyTowerLevel-1);this.tv.scrollToOffset(cc.v2(0,e),.3,!0)})}};return n([u(c.default)],t.prototype,"tv",void 0),t=n([d],t)})();o.default=h,cc._RF.pop()},{"../../../common/data/UserDataManager":"UserDataManager","../../../lib/components/TableView/tableView":"tableView","../../Configs":"Configs","./ShopItem":"ShopItem","./dialog":"dialog"}],sign:[function(t,e,o){"use strict";cc._RF.push(e,"40e6d8oMORM1a67hxkP1k2u","sign");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./dialog"),a=t("./SignItem"),l=t("../../../common/data/UserDataManager"),c=t("../../../common/GameUtils"),r=t("../AdsController"),d=t("../../../common/data/GameNumberUtils"),{ccclass:u,property:h}=cc._decorator;let p=(()=>{let t=class extends s.default{constructor(){super(...arguments),this.items=[],this.imgSignedMark=null,this.btnVideo=null}onLoad(){super.onLoad(),this.btnVideo.node.on("click",this.onSign,this)}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return i(this,void 0,void 0,function*(){this.updateStatus(),yield e.show.call(this,t)})}updateStatus(){this.imgSignedMark.active=l.default.getInstance().isSignToday,this.btnVideo.node.active=!this.imgSignedMark.active;for(let t=0;t<7;++t){let e=t+1;this.items[t].getComponent(a.default).setup(e)}}onSign(){return i(this,void 0,void 0,function*(){if(this.playClickSound(),!(yield r.default.getInstance().showVideo()))return;l.default.getInstance().sign(),this.updateStatus();let t=d.default.getInstance().getDiamondsForSignDay(l.default.getInstance().getSignDays()+1);c.default.showGotTokenEffect(l.TokenType.diamond,t),this.hide()})}};return n([h(cc.Node)],t.prototype,"items",void 0),n([h(cc.Node)],t.prototype,"imgSignedMark",void 0),n([h(cc.Button)],t.prototype,"btnVideo",void 0),t=n([u],t)})();o.default=p,cc._RF.pop()},{"../../../common/GameUtils":"GameUtils","../../../common/data/GameNumberUtils":"GameNumberUtils","../../../common/data/UserDataManager":"UserDataManager","../AdsController":"AdsController","./SignItem":"SignItem","./dialog":"dialog"}],speedUp:[function(t,e,o){"use strict";cc._RF.push(e,"02062vszS9AW5ZS8iDWNzxO","speedUp");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a},i=this&&this.__awaiter||function(t,e,o,n){function i(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,s){function a(t){try{c(n.next(t))}catch(t){s(t)}}function l(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?o(t.value):i(t.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../../../common/i18n/i18n"),a=t("../AdsController"),l=t("./dialog"),c=t("../../BattleEvent"),{ccclass:r,property:d}=cc._decorator;let u=(()=>{let t=class extends l.default{constructor(){super(...arguments),this.btnGot=null,this.lbTips1=null,this.lbTips2=null}onLoad(){super.onLoad(),this.lbTips1.string=s.i18n.get("speedUpTips1"),this.lbTips2.string=s.i18n.get("speedUpTips2"),this.btnGot.node.on("click",this.onGot,this)}onGot(){return i(this,void 0,void 0,function*(){this.playClickSound(),(yield a.default.getInstance().showVideo())&&(yield this.hide(),cc.systemEvent.emit(c.default.speedUp,!0))})}};return n([d(cc.Button)],t.prototype,"btnGot",void 0),n([d(cc.Label)],t.prototype,"lbTips1",void 0),n([d(cc.Label)],t.prototype,"lbTips2",void 0),t=n([r],t)})();o.default=u,cc._RF.pop()},{"../../../common/i18n/i18n":"i18n","../../BattleEvent":"BattleEvent","../AdsController":"AdsController","./dialog":"dialog"}],tableView:[function(t,e,o){"use strict";cc._RF.push(e,"69d3bVd4I9O86NfCyY9uFBO","tableView");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:s}=cc._decorator,a=cc.Enum({Horizontal:0,Vertical:1});cc.Enum({Single:0,Multiple:1});let l=(()=>{let t=class extends cc.ScrollView{constructor(){super(...arguments),this.horizontal=!1,this.vertical=!0,this.scrollEvents=[],this._cell=null,this.cellPool=new cc.NodePool("viewCell"),this.cellData=null,this.cellCount=0,this.childCount=0,this.startIndex=0,this.maxStartIndex=0,this.endIndex=0,this.anchorCenterX=0,this.anchorCenterY=0,this.anchorLeftX=0,this.anchorTopY=0,this.cellAnchorX=0,this.cellAnchorY=0,this.customSize=!1,this.cellAccumSizes=[],this.cellSizes=[],this.cellSize=0,this.updateRefreshOnce=!1,this.updateRefreshForce=!1,this.updateCellsOn=!1,this.updateCellsOnce=!1}get cell(){return this._cell}set cell(t){this.clear(),this.cellPool.clear(),this._cell=t}get scrollModel(){return this.horizontal?a.Horizontal:a.Vertical}set scrollModel(t){cc.error("[tableView] \u4e0d\u5141\u8bb8\u52a8\u6001\u4fee\u6539scrollModel")}onDestroy(){for(;this.cellPool.size();)this.cellPool.get().destroy()}onEnable(){this.node.on("scroll-began",this.onScrollBegin,this),this.node.on("scroll-ended",this.onScrollEnd,this),super.onEnable&&super.onEnable()}onDisable(){this.node.off("scroll-began",this.onScrollBegin,this),this.node.off("scroll-ended",this.onScrollEnd,this),super.onDisable&&super.onDisable()}onScrollBegin(){this.updateCellsOn=!0}onScrollEnd(){this.updateCellsOn=!1,this.updateCellsOnce=!0}getCellCount(){return this.cellCount}setCellCount(t){"number"==typeof t&&t>=0?this.cellCount=t:cc.error("[tableView] setCellCount \u53c2\u6570\u9519\u8bef")}getCellData(){return this.cellData}setCellData(t){void 0!==t&&(this.cellData=t)}getCellRange(){const t=this.content.children;return 0==t.length?{min:-1,max:-1}:{min:t[0].tvIndex,max:t[t.length-1].tvIndex}}refreshScrollBar(){this._updateScrollBar(this._getHowMuchOutOfBoundary())}refresh(t=!0){this.updateRefreshOnce=!0,t&&(this.updateRefreshForce=!0)}refreshSync(t=!0){this.stopRefresh(),this.initData(),this.updateCells(t)}stopRefresh(){this.updateRefreshOnce=!1,this.updateRefreshForce=!1}init(t,e){this.clear(),this.setCellData(e||null),this.setCellCount(t),this.initData(),this.stopAutoScroll(),this.scrollToOrigin(),this.updateCells(!0)}clear(){this.cellCount=0,this.childCount=0,this.startIndex=0,this.endIndex=0,this.maxStartIndex=0,this.content[this.horizontal?"width":"height"]=0,this.stopRefresh(),this.updateCellCount()}reload(t=0,e){if(void 0===e)this.content.children.forEach(e=>{e.tvIndex>=t&&this.reloadCell(e)});else{if(e<=0)return;if(t<0&&(t+=this.cellCount),t+e<0)return;this.content.children.forEach(o=>{o.tvIndex>=t&&o.tvIndex<t+e&&this.reloadCell(o)})}}insert(t=-1,e=1,o){if(e<=0)return;t<0&&(t=t+this.cellCount+1),t<0&&(t=0),this.setCellData(o);const n=this.content.children;for(let o=n.length-1;o>=0;o--){const i=n[o];i._tvIndex>=t&&(i._tvIndex+=e)}this.setCellCount(this.cellCount+e),this.refresh()}remove(t=-1,e=1,o){if(e<=0)return;t<0&&(t+=this.cellCount);let n=t+e;if(t<0&&(t=0),n>this.cellCount&&(n=this.cellCount),e=n-t,t>=this.cellCount||n<=0||e<0||t>=n)return;this.setCellData(o);const i=this.content.children;for(let o=i.length-1;o>=0;o--){const s=i[o];s._tvIndex>=t&&(s._tvIndex<n?s._tvIndex=-1:s._tvIndex-=e)}this.setCellCount(this.cellCount-e),this.refresh()}getCell(){let t=null;return(t=this.cellPool.size()?this.cellPool.get():cc.instantiate(this.cell)).tvIndex=-1,t._tvIndex=-1,t}putCell(t){this.cellPool.put(t)}initCell(t,e){if(e>=0){if(t.tvIndex!=e||t.tvIndex!=t._tvIndex){const o=t.getComponent("viewCell");t.tvIndex>=0&&o.uninit(),o.init(e,this.cellData,this)}t.tvIndex=e,t._tvIndex=e}}uninitCell(t){t.tvIndex>=0&&(t.getComponent("viewCell").uninit(),t.tvIndex=-1,t._tvIndex=-1)}reloadCell(t){t.getComponent("viewCell").reload(this.cellData)}getViewCell(){if(this.cell){const t=this.cell.data.getComponent("viewCell");if(t)return t.constructor||cc.js.getClassByName(cc.js.getClassName(t))}return null}getDefaultCellSize(){return this.cell?this.cell.data.getContentSize():cc.Size.ZERO}getDefaultCellAnchor(){return this.cell?this.cell.data.getAnchorPoint():cc.Vec2.ZERO}getScrollLengh(){const t=this.getScrollOffset(),e=this.horizontal?-t.x:t.y;return e<0?0:e}initData(){const t=this.getViewCell(),e=this.getDefaultCellSize(),o=this.horizontal?"width":"height",n=this.content.parent[o];if(this.customSize=!!t&&!!t.hasOwnProperty("getSize"),this.cellSize=e[o],this.cellAccumSizes.length=0,this.cellSizes.length=0,this.maxStartIndex=0,this.startIndex=0,this.endIndex=0,this.customSize)for(let e=0,o=0,n=0;e<this.cellCount;e++)(!(n=t.getSize(e,this.cellData))||n<0)&&(n=this.cellSize),this.cellSizes.push(n),o+=n,this.cellAccumSizes.push(o);if(this.customSize){this.childCount=this.cellCount;const t=this.cellAccumSizes.length-1,e=this.cellAccumSizes[t];for(let o=1,i=0;o<=t;o++)if(e-(i=this.cellAccumSizes[t-o])>=n){this.childCount=o+1;break}}else this.childCount=Math.ceil(n/this.cellSize)+1;this.cellCount>this.childCount?this.maxStartIndex=this.cellCount-this.childCount:this.maxStartIndex=0,this.customSize?this.content[o]=this.cellAccumSizes[this.cellAccumSizes.length-1]||0:this.content[o]=this.cellSize*this.cellCount;const i=this.getDefaultCellAnchor();this.anchorCenterX=(.5-this.content.anchorX)*this.content.width,this.anchorCenterY=(.5-this.content.anchorY)*this.content.height,this.anchorLeftX=(0-this.content.anchorX)*this.content.width,this.anchorTopY=(1-this.content.anchorY)*this.content.height,this.cellAnchorX=i.x,this.cellAnchorY=1-i.y}updateCellCount(){const t=this.content.children;if(t.length!=this.childCount)if(t.length>this.childCount){let e=null;for(let o=t.length-1;o>=this.childCount;o--)((e=t[o])._tvIndex<this.startIndex||e._tvIndex>this.endIndex)&&(this.uninitCell(e),this.putCell(e));for(let o=t.length-1;o>=this.childCount;o--)e=t[o],this.uninitCell(e),this.putCell(e)}else for(let e=t.length;e<this.childCount;e++)this.content.addChild(this.getCell())}getStartIndex(t){let e=0;const o=this.maxStartIndex;if(this.customSize){const n=this.cellAccumSizes;if(n.length<5)for(;e<o&&!(n[e]>t);e++);else{let i=0,s=o,a=0;for(;s>=i;){if(t==(a=n[e=Math.floor((s+i)/2)])){e<o&&(e+=1);break}if(t<a&&(0==e||t>=n[e-1]))break;t>a?i=e+1:s=e-1}}}else(e=Math.floor(t/this.cellSize))<0?e=0:e>o&&(e=o);return e}updateCellRange(){const t=this.getScrollLengh();if(this.startIndex=this.getStartIndex(t),this.customSize){const e=this.content.parent[this.horizontal?"width":"height"],o=this.cellAccumSizes.length;if(this.cellAccumSizes[o-1]-e<=t)this.childCount=o-this.startIndex;else{const n=this.cellAccumSizes[this.startIndex];for(let i=this.startIndex+1,s=0;i<o;i++)if((s=this.cellAccumSizes[i])-e>=t){this.childCount=s-n>=e?i-this.startIndex+1:i-this.startIndex+2;break}}}this.endIndex=this.startIndex+this.childCount-1}updateCell(t,e){"number"==typeof e?this.initCell(t,e):(this.initCell(t,t._tvIndex),e=t.tvIndex),this.horizontal?(this.customSize?t.x=this.anchorLeftX-this.cellSizes[e]*this.cellAnchorX+this.cellAccumSizes[e]:t.x=this.anchorLeftX-this.cellSize*this.cellAnchorX+this.cellSize*(e+1),t.y=this.anchorCenterY):(this.customSize?t.y=this.anchorTopY+this.cellSizes[e]*this.cellAnchorY-this.cellAccumSizes[e]:t.y=this.anchorTopY+this.cellSize*this.cellAnchorY-this.cellSize*(e+1),t.x=this.anchorCenterX)}updateCells(t=!1){if(this.updateCellsOnce=!1,this.updateCellRange(),this.updateCellCount(),!this.childCount)return;const e=this.startIndex,o=this.endIndex,n=this.content.children;if(!t&&n[0]._tvIndex==e&&n[n.length-1]._tvIndex==o)return;const i=[],s=[];if(n.forEach(t=>{t._tvIndex<e||t._tvIndex>o||t._tvIndex!=t.tvIndex?(this.uninitCell(t),s.push(t)):i.push(t)}),0==s.length)t&&n.forEach(t=>this.updateCell(t));else if(0==i.length)n.forEach((t,o)=>this.updateCell(t,e+o));else for(let t=e,n=0,a=0,l=0;t<=o;t++,l++)n<i.length&&t==i[n]._tvIndex?this.updateCell(i[n++]):this.updateCell(s[a++],t);n.forEach(function(t){t.zIndex=t.tvIndex-e}),this.content.sortAllChildren()}scrollToIndex(t,e,o){console.log("[tableView] scrollToIndex")}getPerScrollOffset(){return this.horizontal?cc.v2(this.getScrollOffset().x/this.getMaxScrollOffset().x,0):cc.v2(0,this.getScrollOffset().y/this.getMaxScrollOffset().y)}scrollToPerOffset(t,e,o){this.horizontal?t.x*=this.getMaxScrollOffset().x:t.y*=this.getMaxScrollOffset().y,this.scrollToOffset(t,e,o)}scrollToOrigin(t,e){this.horizontal?this.scrollToLeft(t,e):this.scrollToTop(t,e)}stopAutoScroll(){!this.updateCellsOnce&&this.updateCellsOn&&(this.updateCellsOnce=!0),super.stopAutoScroll()}scrollToBottom(t,e){t?this.updateCellsOn=!0:this.updateCellsOnce=!0,super.scrollToBottom(t,e)}scrollToTop(t,e){t?this.updateCellsOn=!0:this.updateCellsOnce=!0,super.scrollToTop(t,e)}scrollToLeft(t,e){t?this.updateCellsOn=!0:this.updateCellsOnce=!0,super.scrollToLeft(t,e)}scrollToRight(t,e){t?this.updateCellsOn=!0:this.updateCellsOnce=!0,super.scrollToRight(t,e)}scrollToOffset(t,e,o){e?this.updateCellsOn=!0:this.updateCellsOnce=!0,super.scrollToOffset(t,e,o)}update(t){super.update(t),this.updateRefreshOnce&&this.refreshSync(this.updateRefreshForce),(this.updateCellsOn||this.updateCellsOnce)&&this.updateCells()}};return n([s({visible:!1,override:!0})],t.prototype,"horizontal",void 0),n([s({visible:!1,override:!0})],t.prototype,"vertical",void 0),n([s({type:cc.Component.EventHandler,visible:!1,override:!0})],t.prototype,"scrollEvents",void 0),n([s(cc.Prefab)],t.prototype,"_cell",void 0),n([s({type:cc.Prefab,tooltip:"\u6e32\u67d3\u8282\u70b9"})],t.prototype,"cell",null),n([s({type:a,tooltip:"\u6ed1\u52a8\u65b9\u5411"})],t.prototype,"scrollModel",null),t=n([i],t)})();o.default=l,cc._RF.pop()},{}],viewCell:[function(t,e,o){"use strict";cc._RF.push(e,"1f184vYNcBPKpMTrl9H2zeB","viewCell");var n=this&&this.__decorate||function(t,e,o,n){var i,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,o,a):i(e,o))||a);return s>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:s}=cc._decorator;let a=(()=>{let t=class extends cc.Component{static getSize(t,e){return 0}init(t,e,o){}uninit(){}reload(t){}};return t=n([i],t)})();o.default=a,cc._RF.pop()},{}]},{},["MainScene","BalloonController","BattleController","BattleEvent","Configs","AdsController","IconLabel","DialogManager","LackedToken","NewLevelTower","OfflineCoins","PassMainStage","ShopItem","SignItem","balloon","dialog","double","lottery","option","settings","shop","sign","speedUp","AlertBox","BattleUI","LotteryButton","QuickBuyButton","SellController","SpeedUpButton","StageInfo","TokenUI","Bullet","BulletController","BulletFactory","EffectController","EffectFactory","Enemy","EnemyController","EnemyFactory","GuideController","Attackable","BaseController","DragController","GuildHand","SeedTower","Tower","TowerBase","TowerFactory","AssetsManager","CustomNodePool","FitWidth","GameUtils","SimpleNodePool","SoundsController","constants","GameNumberUtils","UserDataManager","UserTimeData","i18nSprite","chs","en","i18n","PlatformUtils","ArrayUtils","NumberAction","AComponent","AdaptLabelWidth","Draggable","tableView","viewCell"]);